{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/atrin/Desktop/PRODUCTS/cyan/prd/client/pages/ProofReview.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useSearchParams, useNavigate } from \"react-router-dom\";\r\nimport {\r\n    CheckCircle2,\r\n    AlertCircle,\r\n    Loader,\r\n    Send,\n} from \"lucide-react\";\nimport Footer from \"@/components/Footer\";\nimport { toast } from \"sonner\";\r\n\r\nexport default function ProofReview() {\r\n    const [searchParams] = useSearchParams();\r\n    const navigate = useNavigate();\r\n\r\n    const token = searchParams.get(\"token\");\r\n    const action = searchParams.get(\"action\"); // 'approve' or 'revise'\r\n\r\n    const [isProcessing, setIsProcessing] = useState(false);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [revisionNotes, setRevisionNotes] = useState(\"\");\r\n    const [actionCompleted, setActionCompleted] = useState<\"approve\" | \"revise\" | null>(null);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        // Validate token and action exist\r\n        if (!token) {\r\n            setError(\"Invalid proof link. Token is missing.\");\r\n            return;\r\n        }\r\n\r\n        if (!action || (action !== \"approve\" && action !== \"revise\")) {\r\n            setError(\"Invalid action specified in the proof link.\");\r\n            return;\r\n        }\r\n\r\n        // Auto-approve if action is 'approve'\r\n        if (action === \"approve\") {\r\n            handleApprove();\r\n        }\r\n    }, [token, action]);\r\n\r\n    const handleApprove = async () => {\r\n        if (!token) {\r\n            setError(\"Invalid token\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setIsProcessing(true);\r\n            setError(null);\r\n\r\n            // Call the approve endpoint with the token\r\n            // Using /public/ path to avoid conflict with protected route\r\n            const response = await fetch(`/api/proofs/public/token/approve?token=${token}`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const data = await response.json();\r\n                throw new Error(data.error || \"Failed to approve proof\");\r\n            }\r\n\r\n            setActionCompleted(\"approve\");\r\n            toast.success(\"Thank you! Your design has been approved.\");\r\n\r\n            setTimeout(() => {\r\n                navigate(\"/\");\r\n            }, 3000);\r\n        } catch (err: any) {\r\n            const errorMessage = err.message || \"Failed to approve proof. Please try again or contact support.\";\r\n            setError(errorMessage);\r\n            toast.error(errorMessage);\r\n            console.error(err);\r\n        } finally {\r\n            setIsProcessing(false);\r\n        }\r\n    };\r\n\r\n    const handleRequestRevisions = async () => {\r\n        if (!token) {\r\n            setError(\"Invalid token\");\r\n            return;\r\n        }\r\n\r\n        if (!revisionNotes.trim()) {\r\n            toast.error(\"Please describe the changes you'd like\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setIsSubmitting(true);\r\n            setError(null);\r\n\r\n            // Using /public/ path and 'deny' endpoint (backend calls it deny, not revise)\r\n            const response = await fetch(`/api/proofs/public/token/deny?token=${token}`, {\r\n                method: \"POST\",\r\n                headers: { \"Content-Type\": \"application/json\" },\r\n                body: JSON.stringify({ revision_notes: revisionNotes }),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const data = await response.json();\r\n                throw new Error(data.error || \"Failed to submit revision request\");\r\n            }\r\n\r\n            setActionCompleted(\"revise\");\r\n            toast.success(\"Your feedback has been sent. We'll make those changes!\");\r\n\r\n            setTimeout(() => {\r\n                navigate(\"/\");\r\n            }, 3000);\r\n        } catch (err: any) {\r\n            const errorMessage = err.message || \"Failed to submit feedback. Please try again or contact support.\";\r\n            setError(errorMessage);\r\n            toast.error(errorMessage);\r\n            console.error(err);\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    if (isProcessing) {\n        return (\n            <>\n                <main className=\"flex-1 flex items-center justify-center min-h-screen bg-gradient-to-b from-slate-50 to-white\">\n                    <div className=\"text-center\">\r\n                        <Loader className=\"w-12 h-12 animate-spin text-blue-600 mx-auto mb-4\" />\r\n                        <p className=\"text-gray-600\">Processing your approval...</p>\r\n                    </div>\r\n                </main>\r\n                <Footer />\r\n            </>\r\n        );\r\n    }\r\n\r\n    if (error) {\n        return (\n            <>\n                <main className=\"flex-1 flex items-center justify-center min-h-screen bg-gradient-to-b from-slate-50 to-white\">\n                    <div className=\"text-center max-w-md mx-auto px-4\">\r\n                        <AlertCircle className=\"w-12 h-12 text-red-600 mx-auto mb-4\" />\r\n                        <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">\r\n                            {error.includes(\"expired\") || error.includes(\"invalid\") ? \"Link Expired or Invalid\" : \"Something Went Wrong\"}\r\n                        </h1>\r\n                        <p className=\"text-gray-600 mb-6\">\r\n                            {error}\r\n                        </p>\r\n                        <button\r\n                            onClick={() => navigate(\"/\")}\r\n                            className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors\"\r\n                        >\r\n                            Go Home\r\n                        </button>\r\n                    </div>\r\n                </main>\r\n                <Footer />\r\n            </>\r\n        );\r\n    }\r\n\r\n    return (\n        <>\n            <main className=\"flex-1 min-h-screen bg-gradient-to-b from-slate-50 to-white py-12\">\n                <div className=\"max-w-2xl mx-auto px-4\">\r\n                    {/* Header */}\r\n                    <div className=\"text-center mb-12\">\r\n                        <h1 className=\"text-4xl font-bold text-gray-900 mb-3\">\r\n                            {actionCompleted === \"approve\"\r\n                                ? \"Design Approved! ✓\"\r\n                                : actionCompleted === \"revise\"\r\n                                    ? \"Feedback Submitted ✓\"\r\n                                    : action === \"approve\"\r\n                                        ? \"Approving Your Design...\"\r\n                                        : \"Request Design Changes\"}\r\n                        </h1>\r\n                        <p className=\"text-lg text-gray-600\">\r\n                            {actionCompleted === \"approve\"\r\n                                ? \"Thank you for approving your design. We'll move forward with production.\"\r\n                                : actionCompleted === \"revise\"\r\n                                    ? \"Thank you for your feedback. Our design team will make those changes.\"\r\n                                    : action === \"revise\"\r\n                                        ? \"Please describe the changes you'd like us to make to your design.\"\r\n                                        : \"Please wait while we process your approval...\"}\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Status Display for Completed Actions */}\r\n                    {actionCompleted === \"approve\" && (\r\n                        <div className=\"bg-green-50 border border-green-300 rounded-xl p-6 mb-8\">\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <CheckCircle2 className=\"w-6 h-6 text-green-600 flex-shrink-0 mt-0.5\" />\r\n                                <div>\r\n                                    <h3 className=\"font-semibold text-green-900 mb-1\">\r\n                                        Design Approved\r\n                                    </h3>\r\n                                    <p className=\"text-sm text-green-800\">\r\n                                        Your design has been approved. Production will begin soon.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {actionCompleted === \"revise\" && (\r\n                        <div className=\"bg-orange-50 border border-orange-300 rounded-xl p-6 mb-8\">\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <CheckCircle2 className=\"w-6 h-6 text-orange-600 flex-shrink-0 mt-0.5\" />\r\n                                <div>\r\n                                    <h3 className=\"font-semibold text-orange-900 mb-1\">\r\n                                        Feedback Received\r\n                                    </h3>\r\n                                    <p className=\"text-sm text-orange-800\">\r\n                                        We've received your feedback and will make those changes.\r\n                                        We'll send you an updated proof soon.\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Revision Form - only show if action is 'revise' and not completed */}\r\n                    {!actionCompleted && action === \"revise\" && (\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"bg-white border border-gray-300 rounded-xl p-6\">\r\n                                <h3 className=\"font-semibold text-gray-900 mb-4\">\r\n                                    What would you like us to change?\r\n                                </h3>\r\n\r\n                                <textarea\r\n                                    value={revisionNotes}\r\n                                    onChange={(e) => setRevisionNotes(e.target.value)}\r\n                                    placeholder=\"Tell us what you'd like us to change (e.g., different colors, adjust size, move text, etc.)\"\r\n                                    className=\"w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/50 mb-4\"\r\n                                    rows={6}\r\n                                    autoFocus\r\n                                />\r\n\r\n                                <button\r\n                                    onClick={handleRequestRevisions}\r\n                                    disabled={isSubmitting || !revisionNotes.trim()}\r\n                                    className=\"w-full px-6 py-3 bg-orange-600 hover:bg-orange-700 disabled:bg-orange-600/50 text-white font-semibold rounded-lg transition-colors flex items-center justify-center gap-2\"\r\n                                >\r\n                                    {isSubmitting ? (\r\n                                        <>\r\n                                            <Loader className=\"w-5 h-5 animate-spin\" />\r\n                                            Submitting...\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <Send className=\"w-5 h-5\" />\r\n                                            Send Feedback\r\n                                        </>\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Redirecting Message */}\r\n                    {actionCompleted && (\r\n                        <div className=\"text-center mt-8\">\r\n                            <p className=\"text-gray-600\">\r\n                                Redirecting you to the home page in a few seconds...\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </main>\r\n            <Footer />\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}