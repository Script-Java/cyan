{"version":3,"sources":["../../../../client/pages/CheckoutNew.tsx","../../../../components/CheckoutForm.tsx","../../../../components/ShippingOptionsSelector.tsx","../../../../components/SquarePaymentForm.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\nimport CheckoutForm from \"@/components/CheckoutForm\";\nimport ShippingOptionsSelector from \"@/components/ShippingOptionsSelector\";\r\nimport SquarePaymentForm from \"@/components/SquarePaymentForm\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Loader2,\r\n  Trash2,\r\n  Share2,\r\n  ChevronDown,\r\n  AlertCircle,\r\n} from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { useStoreCredit } from \"@/hooks/useStoreCredit\";\r\nimport { formatOrderNumber } from \"@/lib/orderFormatting\";\r\n\r\ninterface CartItem {\r\n  product_id: number;\r\n  product_name?: string;\r\n  quantity: number;\r\n  price?: number;\r\n  image?: string;\r\n  basePrice?: number;\r\n  savePercentage?: number;\r\n  design_file_url?: string;\r\n  selectedOptions?: Record<string, string>;\r\n  options?: Array<{\r\n    id: string;\r\n    name: string;\r\n    values: Array<{ id: string; name: string }>;\r\n  }>;\r\n  product_options?: Array<\r\n    { option_id?: number; option_value?: string } | string\r\n  >;\r\n}\r\n\r\ninterface OrderData {\r\n  subtotal: number;\r\n  tax: number;\r\n  shipping: number;\r\n  discount: number;\r\n  blindShipmentFee: number;\r\n  additionalPayment: number;\r\n  total: number;\r\n  storeCredit: number;\r\n  appliedStoreCredit: number;\r\n}\r\n\r\nexport default function CheckoutNew() {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const cartId = searchParams.get(\"cartId\");\r\n\r\n  const [cartItems, setCartItems] = useState<CartItem[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [expandedOptions, setExpandedOptions] = useState(false);\r\n  const [blindShipmentEnabled, setBlindShipmentEnabled] = useState(false);\r\n  const [additionalPaymentPercent, setAdditionalPaymentPercent] = useState(0);\r\n  const [discountCode, setDiscountCode] = useState(\"\");\r\n  const [appliedDiscount, setAppliedDiscount] = useState(0);\r\n  const [appliedStoreCredit, setAppliedStoreCredit] = useState(0);\r\n  const { storeCredit: availableStoreCredit, fetchStoreCredit } =\r\n    useStoreCredit();\r\n\r\n  const [selectedShippingOptionId, setSelectedShippingOptionId] = useState<\r\n    number | null\r\n  >(null);\r\n  const [shippingCost, setShippingCost] = useState(0);\r\n  const [estimatedDeliveryDate, setEstimatedDeliveryDate] = useState<\r\n    string | null\r\n  >(null);\r\n  const [shippingOptionName, setShippingOptionName] = useState<string>(\"\");\r\n\r\n  const [orderData, setOrderData] = useState<OrderData>({\r\n    subtotal: 0,\r\n    tax: 0,\r\n    shipping: 0,\r\n    discount: 0,\r\n    blindShipmentFee: 0,\r\n    additionalPayment: 0,\r\n    total: 0,\r\n    storeCredit: 0,\r\n    appliedStoreCredit: 0,\r\n  });\r\n\r\n  const [customerInfo, setCustomerInfo] = useState({\r\n    email: \"\",\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    phone: \"\",\r\n    street: \"\",\r\n    street2: \"\",\r\n    city: \"\",\r\n    state: \"CA\",\r\n    postalCode: \"\",\r\n    country: \"US\",\r\n  });\r\n\r\n  const [billingInfo, setBillingInfo] = useState({\r\n    sameAsShipping: true,\r\n    firstName: \"\",\r\n    lastName: \"\",\r\n    street: \"\",\r\n    street2: \"\",\r\n    city: \"\",\r\n    state: \"CA\",\r\n    postalCode: \"\",\r\n    country: \"US\",\r\n  });\r\n\r\n  const [showPaymentForm, setShowPaymentForm] = useState(false);\r\n  const [createdOrderId, setCreatedOrderId] = useState<number | null>(null);\r\n  const [agreedToPolicy, setAgreedToPolicy] = useState(false);\r\n  const [showPolicyDropdown, setShowPolicyDropdown] = useState(false);\r\n  const [policy, setPolicy] = useState<any>(null);\r\n  const [agreedToPrivacy, setAgreedToPrivacy] = useState(false);\r\n  const [agreedToGDPR, setAgreedToGDPR] = useState(true); // Handled on separate legal page\r\n  const [agreedToCCPA, setAgreedToCCPA] = useState(true); // Handled on separate legal page\r\n  const [agreedToTerms, setAgreedToTerms] = useState(false);\r\n  const [agreedToShippingPolicy, setAgreedToShippingPolicy] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const loadCustomerInfo = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"authToken\");\r\n        if (!token) {\r\n          return;\r\n        }\r\n\r\n        const response = await fetch(\"/api/customers/me\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          if (data.customer) {\r\n            const customer = data.customer;\r\n            const primaryAddress = customer.addresses?.[0];\r\n\r\n            console.log(\"Loaded customer info:\", {\r\n              email: customer.email,\r\n              firstName: customer.firstName,\r\n              lastName: customer.lastName,\r\n              phone: customer.phone,\r\n              addresses: customer.addresses?.length || 0,\r\n            });\r\n\r\n            // Validate country code against allowed values\r\n            const validCountries = [\"US\", \"CA\", \"GB\", \"AU\"];\r\n            const countryCode = primaryAddress?.country_code || \"US\";\r\n            const validCountryCode = validCountries.includes(countryCode)\r\n              ? countryCode\r\n              : \"US\";\r\n\r\n            setCustomerInfo({\r\n              email: customer.email || \"\",\r\n              firstName: customer.firstName || \"\",\r\n              lastName: customer.lastName || \"\",\r\n              phone: customer.phone || \"\",\r\n              street: primaryAddress?.street_1 || \"\",\r\n              street2: primaryAddress?.street_2 || \"\",\r\n              city: primaryAddress?.city || \"\",\r\n              state: primaryAddress?.state_or_province || \"CA\",\r\n              postalCode: primaryAddress?.postal_code || \"\",\r\n              country: validCountryCode,\r\n            });\r\n          }\r\n        } else {\r\n          console.warn(\r\n            \"Failed to load customer info, status:\",\r\n            response.status,\r\n          );\r\n        }\r\n      } catch (err) {\r\n        console.warn(\"Failed to load customer info:\", err);\r\n      }\r\n    };\r\n\r\n    const loadCart = async () => {\r\n      try {\r\n        const id = cartId || localStorage.getItem(\"cart_id\");\r\n        const localStorageCart = localStorage.getItem(\"cart\");\r\n\r\n        if (localStorageCart) {\r\n          const customItems = JSON.parse(localStorageCart);\r\n          const items = [];\r\n          for (const item of customItems) {\r\n            try {\r\n              // Construct the correct API endpoint based on productId format\r\n              let productUrl = `/api/public/products/${item.productId}`;\r\n              if (item.productId.startsWith(\"admin_\")) {\r\n                const adminId = item.productId.split(\"_\")[1];\r\n                productUrl = `/api/public/products/admin/${adminId}`;\r\n              } else if (item.productId.startsWith(\"imported_\")) {\r\n                const importedId = item.productId.split(\"_\")[1];\r\n                productUrl = `/api/public/products/imported/${importedId}`;\r\n              }\r\n\r\n              const response = await fetch(productUrl);\r\n              if (!response.ok) {\r\n                console.warn(\r\n                  `Failed to fetch product ${item.productId}: HTTP ${response.status}`,\r\n                );\r\n                continue;\r\n              }\r\n              const productData = await response.json();\r\n              // API returns product data directly for admin/imported products\r\n              const product = productData.product || productData;\r\n\r\n              items.push({\r\n                product_id: item.productId,\r\n                product_name: product.name,\r\n                quantity: item.quantity,\r\n                price: item.pricePerUnit || product.base_price || 0,\r\n                image: product.images?.[0]?.url,\r\n                basePrice: item.basePrice,\r\n                savePercentage: item.savePercentage,\r\n                design_file_url: item.design_file_url,\r\n                selectedOptions: item.selectedOptions,\r\n                options: product.options,\r\n              });\r\n            } catch (err) {\r\n              console.warn(\r\n                `Failed to load product ${item.productId}:`,\r\n                err instanceof Error ? err.message : err,\r\n              );\r\n            }\r\n          }\r\n          setCartItems(items);\r\n          const subtotal = items.reduce(\r\n            (sum: number, item: any) => sum + (item.price || 0) * item.quantity,\r\n            0,\r\n          );\r\n          calculateOrderData(subtotal, 0);\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!id) {\r\n          console.log(\"No cart ID found, skipping cart load\");\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        console.log(\"Loading cart with ID:\", id);\r\n\r\n        let response;\r\n        try {\r\n          response = await fetch(`/api/cart/${id}`);\r\n        } catch (fetchError) {\r\n          console.warn(\"Network error loading cart:\", fetchError);\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        if (!response.ok) {\r\n          console.error(\"Failed to load cart - HTTP error:\", {\r\n            status: response.status,\r\n            statusText: response.statusText,\r\n          });\r\n\r\n          try {\r\n            const errorData = await response.json();\r\n            console.error(\"Error response data:\", errorData);\r\n          } catch (e) {\r\n            console.error(\"Could not parse error response\");\r\n          }\r\n\r\n          if (response.status === 404) {\r\n            console.warn(\"Cart not found, continuing with empty cart\");\r\n            setIsLoading(false);\r\n            return;\r\n          }\r\n\r\n          throw new Error(\r\n            `Failed to load cart: ${response.status} ${response.statusText}`,\r\n          );\r\n        }\r\n\r\n        try {\r\n          const data = await response.json();\r\n          let items = data.data?.line_items || [];\r\n          console.log(\"Cart loaded successfully:\", {\r\n            itemCount: items.length,\r\n            subtotal: data.data?.subtotal,\r\n          });\r\n\r\n          // Enrich cart items with product options for proper display\r\n          const enrichedItems = [];\r\n          for (const item of items) {\r\n            try {\r\n              const response = await fetch(\r\n                `/api/public/products/${item.product_id}`,\r\n              );\r\n              if (response.ok) {\r\n                const productData = await response.json();\r\n                const product = productData.product;\r\n                enrichedItems.push({\r\n                  ...item,\r\n                  options: product.options,\r\n                });\r\n              } else {\r\n                // If product fetch fails, just use the item as-is\r\n                enrichedItems.push(item);\r\n              }\r\n            } catch (err) {\r\n              console.warn(\r\n                `Failed to fetch product ${item.product_id}:`,\r\n                err instanceof Error ? err.message : err,\r\n              );\r\n              // Use item without enriched options\r\n              enrichedItems.push(item);\r\n            }\r\n          }\r\n\r\n          setCartItems(enrichedItems);\r\n\r\n          const subtotal = enrichedItems.reduce(\r\n            (sum: number, item: CartItem) => {\r\n              return sum + (item.price || 0.25) * item.quantity;\r\n            },\r\n            0,\r\n          );\r\n\r\n          calculateOrderData(subtotal, 0);\r\n        } catch (parseError) {\r\n          console.error(\"Error parsing cart response:\", parseError);\r\n          throw new Error(\"Failed to parse cart response\");\r\n        }\r\n      } catch (err) {\r\n        const errorMsg = err instanceof Error ? err.message : String(err);\r\n        console.error(\"Failed to load cart:\", {\r\n          message: errorMsg,\r\n          error: err,\r\n        });\r\n        toast.error(`Cart loading error: ${errorMsg}`);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadCustomerInfo();\r\n    loadCart();\r\n    fetchStoreCredit();\r\n\r\n    const handleVisibilityChange = () => {\r\n      if (!document.hidden) {\r\n        fetchStoreCredit();\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n    };\r\n  }, [cartId, fetchStoreCredit]);\r\n\r\n  useEffect(() => {\r\n    const fetchPolicy = async () => {\r\n      try {\r\n        const response = await fetch(\"/api/return-refund-policy\");\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          setPolicy(data.policy);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to fetch policy:\", err);\r\n      }\r\n    };\r\n\r\n    fetchPolicy();\r\n  }, []);\r\n\r\n  const calculateOrderData = (\r\n    subtotal: number,\r\n    discount: number,\r\n    creditAmount: number = appliedStoreCredit,\r\n    shipping: number = shippingCost,\r\n  ) => {\r\n    const tax = 0; // Tax disabled\r\n    const blindShipmentFee = blindShipmentEnabled ? 5 : 0;\r\n    const additionalPayment =\r\n      (subtotal + tax + shipping + blindShipmentFee - discount) *\r\n      (additionalPaymentPercent / 100);\r\n    const subtotalBeforeCredit =\r\n      subtotal +\r\n      tax +\r\n      shipping +\r\n      blindShipmentFee +\r\n      additionalPayment -\r\n      discount;\r\n    const total = Math.max(0, subtotalBeforeCredit - creditAmount);\r\n    const storeCredit = total * 0.05;\r\n\r\n    setOrderData({\r\n      subtotal,\r\n      tax,\r\n      shipping,\r\n      discount,\r\n      blindShipmentFee,\r\n      additionalPayment,\r\n      total,\r\n      storeCredit,\r\n      appliedStoreCredit: creditAmount,\r\n    });\r\n  };\r\n\r\n  const handleRemoveItem = (index: number) => {\r\n    const updatedItems = cartItems.filter((_, i) => i !== index);\r\n    setCartItems(updatedItems);\r\n\r\n    // Update localStorage\r\n    const localStorageCart = localStorage.getItem(\"cart\");\r\n    if (localStorageCart) {\r\n      const customItems = JSON.parse(localStorageCart);\r\n      const updatedCart = customItems.filter(\r\n        (_: any, i: number) => i !== index,\r\n      );\r\n      localStorage.setItem(\"cart\", JSON.stringify(updatedCart));\r\n\r\n      // Calculate total remaining items\r\n      const totalItems = updatedCart.reduce(\r\n        (sum: number, item: any) => sum + item.quantity,\r\n        0,\r\n      );\r\n\r\n      // Dispatch storage event to update header cart badge\r\n      window.dispatchEvent(\r\n        new StorageEvent(\"storage\", {\r\n          key: \"cart\",\r\n          newValue: JSON.stringify(updatedCart),\r\n          oldValue: JSON.stringify(customItems),\r\n          storageArea: localStorage,\r\n        }),\r\n      );\r\n\r\n      // Show toast with updated count\r\n      toast.success(\r\n        totalItems === 0\r\n          ? \"Item removed from cart\"\r\n          : totalItems === 1\r\n            ? \"1 item removed - 1 item remaining\"\r\n            : `Item removed - ${totalItems} items remaining in cart`,\r\n      );\r\n    } else {\r\n      toast.success(\"Item removed from cart\");\r\n    }\r\n\r\n    const newSubtotal = updatedItems.reduce((sum, item) => {\r\n      return sum + (item.price || 0.25) * item.quantity;\r\n    }, 0);\r\n\r\n    calculateOrderData(newSubtotal, appliedDiscount, appliedStoreCredit);\r\n  };\r\n\r\n  const handleApplyStoreCredit = (amount: number) => {\r\n    const validAmount = Math.max(0, Math.min(amount, availableStoreCredit));\r\n    setAppliedStoreCredit(validAmount);\r\n    calculateOrderData(orderData.subtotal, appliedDiscount, validAmount);\r\n    fetchStoreCredit();\r\n  };\r\n\r\n  const handleApplyDiscount = async () => {\r\n    if (!discountCode) {\r\n      toast.error(\"Please enter a discount code\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(\"/api/discounts/validate\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          code: discountCode,\r\n          orderTotal: orderData.subtotal,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (!response.ok) {\r\n        toast.error(data.error || \"Invalid discount code\");\r\n        return;\r\n      }\r\n\r\n      if (data.success && data.discount) {\r\n        const discountAmount = data.discount.amount;\r\n        setAppliedDiscount(discountAmount);\r\n        calculateOrderData(\r\n          orderData.subtotal,\r\n          discountAmount,\r\n          appliedStoreCredit,\r\n        );\r\n        toast.success(\r\n          `Discount applied! You save $${discountAmount.toFixed(2)}`,\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error applying discount code:\", error);\r\n      toast.error(\"Failed to apply discount code\");\r\n    }\r\n  };\r\n\r\n  const handleAdditionalPayment = (percent: number) => {\r\n    setAdditionalPaymentPercent(percent);\r\n    calculateOrderData(orderData.subtotal, appliedDiscount, appliedStoreCredit);\r\n  };\r\n\r\n  const handleRemoveStoreCredit = () => {\r\n    setAppliedStoreCredit(0);\r\n    calculateOrderData(orderData.subtotal, appliedDiscount, 0);\r\n  };\r\n\r\n  const validateForm = (): boolean => {\r\n    if (\r\n      !customerInfo.firstName ||\r\n      !customerInfo.lastName ||\r\n      !customerInfo.email ||\r\n      !customerInfo.phone ||\r\n      !customerInfo.street ||\r\n      !customerInfo.city ||\r\n      !customerInfo.state ||\r\n      !customerInfo.postalCode ||\r\n      !customerInfo.country\r\n    ) {\r\n      toast.error(\"Please fill in all required shipping fields\");\r\n      return false;\r\n    }\r\n\r\n    if (!billingInfo.sameAsShipping) {\r\n      if (\r\n        !billingInfo.firstName ||\r\n        !billingInfo.lastName ||\r\n        !billingInfo.street ||\r\n        !billingInfo.city ||\r\n        !billingInfo.state ||\r\n        !billingInfo.postalCode ||\r\n        !billingInfo.country\r\n      ) {\r\n        toast.error(\"Please fill in all required billing fields\");\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (cartItems.length === 0) {\r\n      toast.error(\"Your cart is empty\");\r\n      return false;\r\n    }\r\n\r\n    if (!agreedToPolicy) {\r\n      toast.error(\"Please agree to the Return & Refund Policy to proceed\");\r\n      return false;\r\n    }\r\n\r\n    if (!agreedToPrivacy) {\r\n      toast.error(\"Please agree to the Privacy Policy to proceed\");\r\n      return false;\r\n    }\r\n\r\n    if (!agreedToTerms) {\r\n      toast.error(\"Please agree to the Terms of Service to proceed\");\r\n      return false;\r\n    }\r\n\r\n    if (!agreedToShippingPolicy) {\r\n      toast.error(\"Please agree to the Shipping Policy to proceed\");\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  // Helper function to get option display values for an item\r\n  const getOptionsForPayload = (item: CartItem) => {\r\n    // Handle both selectedOptions (from localStorage) and product_options (from API)\r\n    if (item.selectedOptions && Object.keys(item.selectedOptions).length > 0) {\r\n      return Object.entries(item.selectedOptions).map(([optionId, valueId]) => {\r\n        // Look up the human-readable value name and price modifier\r\n        const option = item.options?.find((opt: any) => opt.id === optionId);\r\n        const optionValue = option?.values?.find(\r\n          (val: any) => val.id === valueId,\r\n        );\r\n        const displayValue = optionValue?.name || valueId;\r\n        const priceModifier = optionValue?.priceModifier || 0;\r\n\r\n        return {\r\n          option_id: optionId,\r\n          option_name: option?.name,\r\n          option_value: displayValue,\r\n          modifier_price: priceModifier,\r\n        };\r\n      });\r\n    }\r\n\r\n    // Handle product_options from API carts\r\n    if (item.product_options && item.product_options.length > 0) {\r\n      return item.product_options.map(\r\n        (\r\n          opt:\r\n            | {\r\n              option_id?: number;\r\n              option_value?: string;\r\n              modifier_price?: number;\r\n            }\r\n            | string,\r\n        ) => {\r\n          if (typeof opt === \"string\") {\r\n            return {\r\n              option_id: \"custom\",\r\n              option_value: opt,\r\n              modifier_price: 0,\r\n            };\r\n          }\r\n\r\n          // Look up the modifier_price from the product options definition\r\n          let modifierPrice = (opt as any).modifier_price || 0;\r\n          if (!modifierPrice && item.options && opt.option_id) {\r\n            const optionDef = item.options.find(\r\n              (o: any) => o.id === opt.option_id,\r\n            );\r\n            if (optionDef && optionDef.values) {\r\n              const valueDef = optionDef.values.find(\r\n                (v: any) =>\r\n                  v.id === opt.option_value || v.name === opt.option_value,\r\n              );\r\n              modifierPrice = valueDef?.priceModifier || 0;\r\n            }\r\n          }\r\n\r\n          return {\r\n            option_id: opt.option_id || \"custom\",\r\n            option_name: (() => {\r\n              const optDef = item.options?.find(\r\n                (o: any) => o.id === opt.option_id,\r\n              );\r\n              return optDef?.name || undefined;\r\n            })(),\r\n            option_value: opt.option_value || \"\",\r\n            modifier_price: modifierPrice,\r\n          };\r\n        },\r\n      );\r\n    }\r\n\r\n    return [];\r\n  };\r\n\r\n  const handleCheckout = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      const customerId = localStorage.getItem(\"customerId\");\r\n\r\n      const checkoutPayload = {\r\n        amount: orderData.total,\r\n        currency: \"USD\",\r\n        items: cartItems.map((item) => ({\r\n          product_id: item.product_id,\r\n          product_name: item.product_name,\r\n          quantity: item.quantity,\r\n          price: item.price,\r\n          design_file_url: item.design_file_url,\r\n          options: getOptionsForPayload(item),\r\n        })),\r\n        phone: customerInfo.phone,\r\n        shippingAddress: {\r\n          firstName: customerInfo.firstName,\r\n          lastName: customerInfo.lastName,\r\n          street: customerInfo.street,\r\n          street2: customerInfo.street2,\r\n          city: customerInfo.city,\r\n          state: customerInfo.state,\r\n          postalCode: customerInfo.postalCode,\r\n          country: customerInfo.country,\r\n        },\r\n        billingAddress: billingInfo.sameAsShipping\r\n          ? {\r\n            firstName: customerInfo.firstName,\r\n            lastName: customerInfo.lastName,\r\n            street: customerInfo.street,\r\n            street2: customerInfo.street2,\r\n            city: customerInfo.city,\r\n            state: customerInfo.state,\r\n            postalCode: customerInfo.postalCode,\r\n            country: customerInfo.country,\r\n          }\r\n          : {\r\n            firstName: billingInfo.firstName,\r\n            lastName: billingInfo.lastName,\r\n            street: billingInfo.street,\r\n            street2: billingInfo.street2,\r\n            city: billingInfo.city,\r\n            state: billingInfo.state,\r\n            postalCode: billingInfo.postalCode,\r\n            country: billingInfo.country,\r\n          },\r\n        subtotal: orderData.subtotal,\r\n        tax: orderData.tax,\r\n        shipping: orderData.shipping,\r\n        discount: appliedDiscount,\r\n        discountCode: discountCode || undefined,\r\n        total: orderData.total,\r\n        appliedStoreCredit: appliedStoreCredit,\r\n        customerId: customerId ? parseInt(customerId) : undefined,\r\n        customerEmail: customerInfo.email,\r\n        customerName: `${customerInfo.firstName} ${customerInfo.lastName}`,\r\n        ...(selectedShippingOptionId && {\r\n          shipping_option_id: selectedShippingOptionId,\r\n        }),\r\n        shipping_option_name: shippingOptionName,\r\n        estimated_delivery_date: estimatedDeliveryDate,\r\n        policies: {\r\n          returnAndRefund: agreedToPolicy,\r\n          privacy: agreedToPrivacy,\r\n          gdpr: agreedToGDPR,\r\n          ccpa: agreedToCCPA,\r\n          terms: agreedToTerms,\r\n          shipping: agreedToShippingPolicy,\r\n        },\r\n      };\r\n\r\n      console.log(\"Checkout payload being sent:\", {\r\n        amount: checkoutPayload.amount,\r\n        items: checkoutPayload.items?.length,\r\n        customerEmail: checkoutPayload.customerEmail,\r\n        total: checkoutPayload.total,\r\n        payloadSize: JSON.stringify(checkoutPayload).length,\r\n      });\r\n\r\n      // Create abort controller for timeout\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\r\n\r\n      let response;\r\n      let result;\r\n\r\n      try {\r\n        response = await fetch(\"/api/square/checkout\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n          body: JSON.stringify(checkoutPayload),\r\n          signal: controller.signal,\r\n        });\r\n\r\n        clearTimeout(timeoutId);\r\n        console.log(\"Checkout response status:\", response.status);\r\n\r\n        // Try to parse response\r\n        try {\r\n          result = await response.json();\r\n        } catch (parseError) {\r\n          console.error(\"Failed to parse checkout response:\", parseError);\r\n          throw new Error(\r\n            `Server error (${response.status}): Could not parse response`,\r\n          );\r\n        }\r\n\r\n        console.log(\"Checkout response data:\", result);\r\n\r\n        if (!response.ok) {\r\n          const errorMsg =\r\n            result?.error ||\r\n            result?.message ||\r\n            `HTTP ${response.status}: Checkout failed`;\r\n          throw new Error(errorMsg);\r\n        }\r\n      } catch (fetchErr) {\r\n        clearTimeout(timeoutId);\r\n        if (fetchErr instanceof Error && fetchErr.name === \"AbortError\") {\r\n          throw new Error(\r\n            \"Request timeout: Checkout is taking too long. Please try again.\",\r\n          );\r\n        }\r\n        // Network errors\r\n        if (fetchErr instanceof TypeError) {\r\n          console.error(\"Network error details:\", {\r\n            message: fetchErr.message,\r\n            stack: fetchErr.stack,\r\n          });\r\n          throw new Error(\r\n            `Network error: ${fetchErr.message}. Please check your connection and try again.`,\r\n          );\r\n        }\r\n        throw fetchErr;\r\n      }\r\n\r\n      // Store the order ID\r\n      if (result.order?.id) {\r\n        setCreatedOrderId(result.order.id);\r\n\r\n        // If there's a checkout URL (Square Payment Link), redirect to it\r\n        if (result.checkoutUrl) {\r\n          toast.success(\"Order created! Redirecting to payment...\");\r\n          setTimeout(() => {\r\n            window.location.href = result.checkoutUrl;\r\n          }, 1000);\r\n        } else {\r\n          // Otherwise show the payment form\r\n          setShowPaymentForm(true);\r\n          toast.success(\"Order created! Please complete payment below.\");\r\n        }\r\n      } else {\r\n        throw new Error(\"No order ID returned from checkout\");\r\n      }\r\n    } catch (err) {\r\n      const errorMessage =\r\n        err instanceof Error ? err.message : \"Checkout failed\";\r\n      toast.error(errorMessage);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handlePaymentSuccess = (token: string) => {\r\n    // Store credit fetch disabled temporarily\r\n    // fetchStoreCredit();\r\n\r\n    // Clear cart before redirecting\r\n    localStorage.removeItem(\"cart\");\r\n    localStorage.removeItem(\"cart_id\");\r\n\r\n    // Redirect to order confirmation page with formatted order number\r\n    if (createdOrderId) {\r\n      setTimeout(() => {\r\n        const formattedOrderId = formatOrderNumber(createdOrderId);\r\n        navigate(`/order-confirmation/${formattedOrderId}`);\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  const handleCustomerInfoChange = (field: string, value: string) => {\r\n    setCustomerInfo((prev) => ({\r\n      ...prev,\r\n      [field]: value,\r\n    }));\r\n  };\r\n\r\n  const handleBillingInfoChange = (field: string, value: string | boolean) => {\r\n    if (field === \"sameAsShipping\") {\r\n      setBillingInfo((prev) => ({\r\n        ...prev,\r\n        sameAsShipping: value as boolean,\r\n      }));\r\n      if (value) {\r\n        setBillingInfo((prev) => ({\r\n          ...prev,\r\n          firstName: customerInfo.firstName,\r\n          lastName: customerInfo.lastName,\r\n          street: customerInfo.street,\r\n          street2: customerInfo.street2,\r\n          city: customerInfo.city,\r\n          state: customerInfo.state,\r\n          postalCode: customerInfo.postalCode,\r\n          country: customerInfo.country,\r\n        }));\r\n      }\r\n    } else {\r\n      setBillingInfo((prev) => ({\r\n        ...prev,\r\n        [field]: value,\r\n      }));\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <>\n        <main className=\"pt-20 min-h-screen bg-[#fafafa] flex items-center justify-center\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-blue-600\" />\n        </main>\n      </>\n    );\n  }\n\n  return (\n    <>\n      {/* Skip to Main Content Link - Accessibility */}\n      <a\n        href=\"#checkout-form\"\n        className=\"sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 bg-blue-600 text-white px-4 py-2\"\n      >\n        Skip to checkout form\n      </a>\r\n\r\n      <main\r\n        className=\"pt-20 min-h-screen bg-[#fafafa] text-gray-900 px-4 sm:px-6 md:px-10 py-6 sm:py-8 md:py-12\"\r\n        id=\"checkout-main\"\r\n        role=\"main\"\r\n        aria-label=\"Checkout page\"\r\n      >\r\n        <div className=\"max-w-7xl mx-auto pt-[15px]\">\r\n          <h1 className=\"text-2xl sm:text-3xl md:text-4xl font-bold mb-4 sm:mb-6 md:mb-8\">\r\n            Your Cart\r\n          </h1>\r\n\r\n          <form onSubmit={handleCheckout}>\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n              {/* Cart Items & Form */}\r\n              <div className=\"lg:col-span-2 space-y-6\">\r\n                {cartItems.map((item, index) => (\r\n                  <div\r\n                    key={index}\r\n                    className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-4 sm:p-6\"\r\n                  >\r\n                    <div className=\"flex gap-3 sm:gap-6 flex-col sm:flex-row\">\r\n                      <div className=\"flex flex-col gap-3 sm:gap-4 flex-shrink-0\">\r\n                        <div className=\"w-24 h-24 sm:w-40 md:w-48 sm:h-40 md:h-48 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center\">\r\n                          {item.image ? (\r\n                            <img\r\n                              src={item.image}\r\n                              alt={item.product_name}\r\n                              className=\"w-full h-full object-cover rounded-xl\"\r\n                            />\r\n                          ) : (\r\n                            <div className=\"text-gray-500 text-center\">\r\n                              <p className=\"text-sm\">No image</p>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {item.design_file_url && (\r\n                          <div className=\"w-24 sm:w-40 md:w-48 bg-white border border-gray-200 rounded-xl flex items-center justify-center p-2\">\r\n                            {item.design_file_url.match(\r\n                              /\\.(jpg|jpeg|png|gif|webp)$/i,\r\n                            ) ||\r\n                              item.design_file_url.startsWith(\"data:image\") ? (\r\n                              <img\r\n                                src={item.design_file_url}\r\n                                alt=\"Design thumbnail\"\r\n                                className=\"w-full h-auto object-contain rounded-lg\"\r\n                              />\r\n                            ) : (\r\n                              <div className=\"p-4 text-center\">\r\n                                <p className=\"text-xs text-gray-600\">\r\n                                  Design file uploaded\r\n                                </p>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex justify-between items-start mb-3 sm:mb-4 gap-3\">\r\n                          <div>\r\n                            <h3 className=\"text-lg sm:text-xl font-bold\">\r\n                              {item.product_name ||\r\n                                `Product #${item.product_id}`}\r\n                            </h3>\r\n                            <div className=\"text-sm space-y-1\">\r\n                              {item.savePercentage &&\r\n                                item.savePercentage > 0 ? (\r\n                                <>\r\n                                  {(() => {\r\n                                    const basePrice =\r\n                                      item.basePrice ||\r\n                                      item.price /\r\n                                      (1 - item.savePercentage / 100);\r\n                                    const regularTotal =\r\n                                      basePrice * item.quantity;\r\n                                    const amountSaved =\r\n                                      ((basePrice * item.savePercentage) /\r\n                                        100) *\r\n                                      item.quantity;\r\n                                    const total =\r\n                                      (item.price || 0.25) * item.quantity;\r\n                                    return (\r\n                                      <>\r\n                                        {basePrice > 0 && (\r\n                                          <p className=\"text-gray-600\">\r\n                                            Regular: ${regularTotal.toFixed(2)}\r\n                                          </p>\r\n                                        )}\r\n                                        <p className=\"text-gray-600\">\r\n                                          Quantity: {item.quantity}\r\n                                        </p>\r\n                                        <p className=\"text-green-600 font-semibold\">\r\n                                          Save {item.savePercentage}%\r\n                                        </p>\r\n                                        <p className=\"text-green-600\">\r\n                                          Amount Saved: $\r\n                                          {amountSaved.toFixed(2)}\r\n                                        </p>\r\n                                        <p className=\"text-gray-900 font-bold border-t border-gray-200 pt-1\">\r\n                                          Total: ${total.toFixed(2)}\r\n                                        </p>\r\n                                      </>\r\n                                    );\r\n                                  })()}\r\n                                </>\r\n                              ) : (\r\n                                <p className=\"text-gray-600\">\r\n                                  $\r\n                                  {(\r\n                                    (item.price || 0.25) * item.quantity\r\n                                  ).toFixed(2)}\r\n                                </p>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={() => handleRemoveItem(index)}\r\n                            className=\"text-red-500 hover:text-red-400 transition\"\r\n                          >\r\n                            <Trash2 className=\"w-5 h-5\" />\r\n                          </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-3 bg-gray-50 rounded-lg p-4 mb-4\">\r\n                          <h4 className=\"text-blue-600 text-sm font-bold uppercase tracking-wider\">\r\n                            Product Specifications\r\n                          </h4>\r\n                          <div className=\"space-y-2 text-sm\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <span className=\"text-gray-600\">\r\n                                Price per sticker\r\n                              </span>\r\n                              <span className=\"font-medium\">\r\n                                ${(item.price || 0.25).toFixed(2)}\r\n                              </span>\r\n                            </div>\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <span className=\"text-gray-600\">Quantity</span>\r\n                              <span className=\"font-medium\">\r\n                                {item.quantity}\r\n                              </span>\r\n                            </div>\r\n                            {/* Handle both selectedOptions (from localStorage) and product_options (from API) */}\r\n                            {item.selectedOptions &&\r\n                              Object.keys(item.selectedOptions).length > 0 && (\r\n                                <>\r\n                                  {Object.entries(item.selectedOptions).map(\r\n                                    ([optionId, valueId]) => {\r\n                                      // Find the option and its value name\r\n                                      const option = item.options?.find(\r\n                                        (opt: any) => opt.id === optionId,\r\n                                      );\r\n                                      const optionValue = option?.values?.find(\r\n                                        (val: any) => val.id === valueId,\r\n                                      );\r\n                                      const displayValue =\r\n                                        optionValue?.name || valueId;\r\n\r\n                                      return (\r\n                                        <div\r\n                                          key={optionId}\r\n                                          className=\"flex items-center justify-between\"\r\n                                        >\r\n                                          <span className=\"text-gray-600\">\r\n                                            {option?.name || \"Option\"}\r\n                                          </span>\r\n                                          <span className=\"font-medium\">\r\n                                            {displayValue}\r\n                                          </span>\r\n                                        </div>\r\n                                      );\r\n                                    },\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                            {/* Handle product_options from API carts */}\r\n                            {!item.selectedOptions &&\r\n                              item.product_options &&\r\n                              item.product_options.length > 0 && (\r\n                                <>\r\n                                  {item.product_options.map(\r\n                                    (\r\n                                      opt:\r\n                                        | {\r\n                                          option_id?: number;\r\n                                          option_value?: string;\r\n                                        }\r\n                                        | string,\r\n                                      idx: number,\r\n                                    ) => {\r\n                                      // Handle both simple string options and structured options\r\n                                      const optionValue =\r\n                                        typeof opt === \"string\"\r\n                                          ? opt\r\n                                          : opt.option_value || \"\";\r\n\r\n                                      // Try to find the option name from the options array\r\n                                      const optionName =\r\n                                        typeof opt !== \"string\" &&\r\n                                          opt.option_id &&\r\n                                          item.options\r\n                                          ? item.options.find(\r\n                                            (o: any) =>\r\n                                              o.id === opt.option_id,\r\n                                          )?.name\r\n                                          : null;\r\n\r\n                                      return (\r\n                                        <div\r\n                                          key={idx}\r\n                                          className=\"flex items-center justify-between\"\r\n                                        >\r\n                                          <span className=\"text-gray-600\">\r\n                                            {optionName || \"Option\"}\r\n                                          </span>\r\n                                          <span className=\"font-medium\">\r\n                                            {optionValue}\r\n                                          </span>\r\n                                        </div>\r\n                                      );\r\n                                    },\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                          <label className=\"text-blue-600 text-sm font-bold uppercase tracking-wider\">\r\n                            Additional Notes\r\n                          </label>\r\n                          <textarea\r\n                            placeholder=\"Any special instructions or requests...\"\r\n                            rows={3}\r\n                            className=\"w-full bg-white border border-gray-200 rounded-lg px-4 py-2 text-gray-900 placeholder-gray-400 text-sm\"\r\n                          />\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n\r\n                <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-6\">\r\n                  <fieldset>\r\n                    <legend className=\"sr-only\">Discount Code Section</legend>\r\n                    {appliedDiscount > 0 ? (\r\n                      <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n                        <div className=\"flex justify-between items-center mb-3\">\r\n                          <div>\r\n                            <p className=\"text-sm text-gray-600\">\r\n                              Discount Applied\r\n                            </p>\r\n                            <p className=\"text-xl font-bold text-green-600\">\r\n                              -${appliedDiscount.toFixed(2)}\r\n                            </p>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                              Code:{\" \"}\r\n                              <code className=\"font-mono\">{discountCode}</code>\r\n                            </p>\r\n                          </div>\r\n                          <Button\r\n                            type=\"button\"\r\n                            onClick={() => {\r\n                              setDiscountCode(\"\");\r\n                              setAppliedDiscount(0);\r\n                              calculateOrderData(\r\n                                orderData.subtotal,\r\n                                0,\r\n                                appliedStoreCredit,\r\n                              );\r\n                              toast.info(\"Discount code removed\");\r\n                            }}\r\n                            variant=\"outline\"\r\n                            className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                          >\r\n                            Remove\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"flex gap-2\">\r\n                        <div className=\"flex-1 relative\">\r\n                          <label htmlFor=\"discount-code\" className=\"sr-only\">\r\n                            Discount code\r\n                          </label>\r\n                          <Input\r\n                            id=\"discount-code\"\r\n                            placeholder=\"Discount code\"\r\n                            value={discountCode}\r\n                            onChange={(e) => setDiscountCode(e.target.value)}\r\n                            onKeyDown={(e) => {\r\n                              if (e.key === \"Enter\") {\r\n                                handleApplyDiscount();\r\n                              }\r\n                            }}\r\n                            className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400\"\r\n                            aria-label=\"Discount code\"\r\n                            aria-describedby=\"discount-help\"\r\n                          />\r\n                          <span id=\"discount-help\" className=\"sr-only\">\r\n                            Enter your discount code to apply savings to your\r\n                            order\r\n                          </span>\r\n                        </div>\r\n                        <Button\r\n                          type=\"button\"\r\n                          onClick={handleApplyDiscount}\r\n                          disabled={!discountCode}\r\n                          className=\"bg-green-500 hover:bg-green-600 text-white px-6\"\r\n                          aria-label=\"Apply discount code\"\r\n                        >\r\n                          Apply\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                  </fieldset>\r\n                </div>\r\n\r\n                <CheckoutForm\r\n                  customerInfo={customerInfo}\r\n                  billingInfo={billingInfo}\r\n                  onCustomerChange={handleCustomerInfoChange}\r\n                  onBillingChange={handleBillingInfoChange}\r\n                />\r\n\r\n                {/* Return & Refund Policy Agreement */}\r\n                <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-6\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPolicyDropdown(!showPolicyDropdown)}\r\n                    className=\"w-full flex items-center justify-between mb-4 hover:opacity-80 transition\"\r\n                  >\r\n                    <h4 className=\"text-gray-900 font-bold text-lg\">\r\n                      Return & Refund Policy\r\n                    </h4>\r\n                    <ChevronDown\r\n                      className={`w-5 h-5 text-gray-600 transition-transform ${showPolicyDropdown ? \"rotate-180\" : \"\"\r\n                        }`}\r\n                    />\r\n                  </button>\r\n\r\n                  {showPolicyDropdown && (\r\n                    <div className=\"mb-4 pb-4 border-b border-gray-200\">\r\n                      <div className=\"bg-gray-50 rounded-lg p-4 mb-4 max-h-80 overflow-y-auto text-sm space-y-3\">\r\n                        {policy ? (\r\n                          <>\r\n                            <div>\r\n                              <p className=\"font-semibold text-gray-900 mb-2\">\r\n                                {policy.guarantee_days}-Day Money-Back Guarantee\r\n                              </p>\r\n                              <p className=\"text-gray-600\">\r\n                                We offer a {policy.guarantee_days}-day\r\n                                money-back guarantee on all orders. If you're\r\n                                not satisfied with your custom stickers for any\r\n                                reason, you can request a full refund within{\" \"}\r\n                                {policy.guarantee_days} days of your purchase.\r\n                              </p>\r\n                            </div>\r\n\r\n                            {policy.return_conditions &&\r\n                              policy.return_conditions.length > 0 && (\r\n                                <div>\r\n                                  <p className=\"font-semibold text-gray-900 mb-2\">\r\n                                    Return Conditions\r\n                                  </p>\r\n                                  <ul className=\"text-gray-600 space-y-1\">\r\n                                    {policy.return_conditions.map(\r\n                                      (condition: string, index: number) => (\r\n                                        <li key={index}> {condition}</li>\r\n                                      ),\r\n                                    )}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n\r\n                            {policy.how_to_return &&\r\n                              policy.how_to_return.length > 0 && (\r\n                                <div>\r\n                                  <p className=\"font-semibold text-gray-900 mb-2\">\r\n                                    How to Return\r\n                                  </p>\r\n                                  <ol className=\"text-gray-600 space-y-1\">\r\n                                    {policy.how_to_return.map(\r\n                                      (step: string, index: number) => (\r\n                                        <li key={index}>\r\n                                          {index + 1}. {step}\r\n                                        </li>\r\n                                      ),\r\n                                    )}\r\n                                  </ol>\r\n                                </div>\r\n                              )}\r\n\r\n                            <div>\r\n                              <p className=\"font-semibold text-gray-900 mb-2\">\r\n                                Defective or Damaged Items\r\n                              </p>\r\n                              <p className=\"text-gray-600\">\r\n                                If your stickers arrive damaged or defective,\r\n                                we'll replace them at no cost to you within{\" \"}\r\n                                {policy.defective_items_days} days of delivery.\r\n                              </p>\r\n                            </div>\r\n\r\n                            {policy.non_returnable_items &&\r\n                              policy.non_returnable_items.length > 0 && (\r\n                                <div>\r\n                                  <p className=\"font-semibold text-gray-900 mb-2\">\r\n                                    Non-Returnable Items\r\n                                  </p>\r\n                                  <ul className=\"text-gray-600 space-y-1\">\r\n                                    {policy.non_returnable_items.map(\r\n                                      (item: string, index: number) => (\r\n                                        <li key={index}> {item}</li>\r\n                                      ),\r\n                                    )}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n\r\n                            <div>\r\n                              <p className=\"font-semibold text-gray-900 mb-2\">\r\n                                Refund Timeline\r\n                              </p>\r\n                              <p className=\"text-gray-600\">\r\n                                {policy.refund_timeline}\r\n                              </p>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-2 pt-2 border-t border-gray-200\">\r\n                              <a\r\n                                href=\"/return-refund-policy\"\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className=\"text-blue-600 hover:text-blue-700 font-medium text-sm\"\r\n                              >\r\n                                Read Full Policy \r\n                              </a>\r\n                            </div>\r\n                          </>\r\n                        ) : (\r\n                          <p className=\"text-gray-500 text-sm\">\r\n                            Loading policy...\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div className=\"flex items-start gap-3\">\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      id=\"agreeToPolicy\"\r\n                      checked={agreedToPolicy}\r\n                      onChange={(e) => setAgreedToPolicy(e.target.checked)}\r\n                      className=\"w-5 h-5 rounded border-gray-300 text-green-600 focus:ring-2 focus:ring-green-500 mt-1 flex-shrink-0 cursor-pointer\"\r\n                    />\r\n                    <label\r\n                      htmlFor=\"agreeToPolicy\"\r\n                      className=\"text-gray-600 text-sm flex-1 cursor-pointer\"\r\n                    >\r\n                      I have read and agree to the{\" \"}\r\n                      <a\r\n                        href=\"/return-refund-policy\"\r\n                        target=\"_blank\"\r\n                        rel=\"noopener noreferrer\"\r\n                        className=\"text-blue-600 hover:text-blue-700 font-medium\"\r\n                      >\r\n                        Return & Refund Policy\r\n                      </a>\r\n                    </label>\r\n                  </div>\r\n\r\n                  {!agreedToPolicy && (\r\n                    <div\r\n                      className=\"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg flex gap-2\"\r\n                      role=\"alert\"\r\n                    >\r\n                      <AlertCircle\r\n                        className=\"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5\"\r\n                        aria-hidden=\"true\"\r\n                      />\r\n                      <p className=\"text-xs text-amber-800\">\r\n                        You must agree to the Return & Refund Policy to complete\r\n                        your purchase.\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Privacy Policy & Data Handling */}\r\n                  <div className=\"border-t border-gray-200 pt-6 mt-6\">\r\n                    <h4 className=\"text-gray-900 font-bold text-lg mb-4\">\r\n                      Privacy & Data Protection\r\n                    </h4>\r\n\r\n                    {/* Privacy Policy Agreement */}\r\n                    <div className=\"flex items-start gap-3 mb-4\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        id=\"agreeToPrivacy\"\r\n                        checked={agreedToPrivacy}\r\n                        onChange={(e) => setAgreedToPrivacy(e.target.checked)}\r\n                        className=\"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 mt-1 flex-shrink-0 cursor-pointer\"\r\n                      />\r\n                      <label\r\n                        htmlFor=\"agreeToPrivacy\"\r\n                        className=\"text-gray-600 text-sm flex-1 cursor-pointer\"\r\n                      >\r\n                        I have read and agree to the{\" \"}\r\n                        <a\r\n                          href=\"/privacy\"\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"text-blue-600 hover:text-blue-700 font-medium\"\r\n                        >\r\n                          Privacy Policy\r\n                        </a>\r\n                      </label>\r\n                    </div>\r\n\r\n                    {/* Terms of Service */}\r\n                    <div className=\"flex items-start gap-3 mb-4\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        id=\"agreeToTerms\"\r\n                        checked={agreedToTerms}\r\n                        onChange={(e) => setAgreedToTerms(e.target.checked)}\r\n                        className=\"w-5 h-5 rounded border-gray-300 text-red-600 focus:ring-2 focus:ring-red-500 mt-1 flex-shrink-0 cursor-pointer\"\r\n                      />\r\n                      <label\r\n                        htmlFor=\"agreeToTerms\"\r\n                        className=\"text-gray-600 text-sm flex-1 cursor-pointer\"\r\n                      >\r\n                        I have read and agree to the{\" \"}\r\n                        <a\r\n                          href=\"/terms\"\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"text-blue-600 hover:text-blue-700 font-medium\"\r\n                        >\r\n                          Terms of Service\r\n                        </a>\r\n                      </label>\r\n                    </div>\r\n\r\n                    {/* Shipping Policy */}\r\n                    <div className=\"flex items-start gap-3 mb-4\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        id=\"agreeToShippingPolicy\"\r\n                        checked={agreedToShippingPolicy}\r\n                        onChange={(e) =>\r\n                          setAgreedToShippingPolicy(e.target.checked)\r\n                        }\r\n                        className=\"w-5 h-5 rounded border-gray-300 text-green-600 focus:ring-2 focus:ring-green-500 mt-1 flex-shrink-0 cursor-pointer\"\r\n                      />\r\n                      <label\r\n                        htmlFor=\"agreeToShippingPolicy\"\r\n                        className=\"text-gray-600 text-sm flex-1 cursor-pointer\"\r\n                      >\r\n                        I have read and agree to the{\" \"}\r\n                        <a\r\n                          href=\"/shipping\"\r\n                          target=\"_blank\"\r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"text-blue-600 hover:text-blue-700 font-medium\"\r\n                        >\r\n                          Shipping Policy\r\n                        </a>\r\n                      </label>\r\n                    </div>\r\n\r\n                    {/* Data Handling Transparency */}\r\n                    <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-gray-700\">\r\n                      <p className=\"font-semibold text-gray-900 mb-2\">\r\n                        How We Handle Your Data\r\n                      </p>\r\n                      <ul className=\"space-y-2 text-xs\">\r\n                        <li>\r\n                           Your personal information is encrypted and\r\n                          transmitted securely using SSL/TLS\r\n                        </li>\r\n                        <li>\r\n                           Payment information is processed by Square and never\r\n                          stored on our servers\r\n                        </li>\r\n                        <li>\r\n                           We do not sell or share your personal data with\r\n                          third parties for marketing\r\n                        </li>\r\n                        <li>\r\n                           You can request access, correction, or deletion of\r\n                          your data at any time\r\n                        </li>\r\n                        <li>\r\n                           We retain your data only as long as necessary for\r\n                          order fulfillment and legal compliance\r\n                        </li>\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {(!agreedToPrivacy ||\r\n                    !agreedToTerms ||\r\n                    !agreedToShippingPolicy) && (\r\n                      <div className=\"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg flex gap-2\">\r\n                        <AlertCircle className=\"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5\" />\r\n                        <p className=\"text-xs text-amber-800\">\r\n                          You must agree to all policies and terms to complete\r\n                          your purchase.\r\n                        </p>\r\n                      </div>\r\n                    )}\r\n\r\n                  {/* Support Contact Info */}\r\n                  <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-6 mt-6\">\r\n                    <h4 className=\"text-gray-900 font-bold mb-4 flex items-center gap-2\">\r\n                       Need Help?\r\n                    </h4>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 mb-1\">\r\n                          Email Support\r\n                        </p>\r\n                        <a\r\n                          href=\"mailto:sticky@stickerland.com\"\r\n                          className=\"text-blue-600 hover:text-blue-700 font-medium text-sm break-all\"\r\n                        >\r\n                          sticky@stickerland.com\r\n                        </a>\r\n                      </div>\r\n                      <div>\r\n                        <p className=\"text-xs text-gray-600 mb-1\">\r\n                          Create a Support Ticket\r\n                        </p>\r\n                        <a\r\n                          href=\"/support\"\r\n                          className=\"text-blue-600 hover:text-blue-700 font-medium text-sm\"\r\n                        >\r\n                          Contact Support \r\n                        </a>\r\n                      </div>\r\n                      <div className=\"pt-2 border-t border-gray-200\">\r\n                        <p className=\"text-xs text-gray-500\">\r\n                          We typically respond within 24 hours\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Order Summary Sidebar */}\r\n              <div className=\"lg:col-span-1\">\r\n                <div className=\"sticky top-32 space-y-6\">\r\n                  <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-6\">\r\n                    <div className=\"flex justify-between items-center mb-6\">\r\n                      <h3 className=\"text-xl font-bold\">Order Summary</h3>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"text-gray-600 hover:text-gray-900 transition\"\r\n                      >\r\n                        <Share2 className=\"w-5 h-5\" />\r\n                      </button>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3 text-sm mb-6 pb-6 border-b border-gray-200\">\r\n                      <div className=\"flex justify-between text-gray-600\">\r\n                        <span>Subtotal ({cartItems.length} items)</span>\r\n                        <span>${orderData.subtotal.toFixed(2)}</span>\r\n                      </div>\r\n                      <div className=\"flex justify-between text-gray-600\">\r\n                        <span>You're paying</span>\r\n                        <span>\r\n                          $\r\n                          {(\r\n                            orderData.subtotal /\r\n                            (cartItems.reduce(\r\n                              (sum, i) => sum + i.quantity,\r\n                              0,\r\n                            ) || 1)\r\n                          ).toFixed(2)}{\" \"}\r\n                          per sticker\r\n                        </span>\r\n                      </div>\r\n                      {shippingCost > 0 && (\r\n                        <div className=\"flex justify-between text-blue-600\">\r\n                          <span>Shipping</span>\r\n                          <span className=\"font-bold\">\r\n                            ${shippingCost.toFixed(2)}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                      {shippingCost === 0 && (\r\n                        <div className=\"flex justify-between text-green-600\">\r\n                          <span>Shipping</span>\r\n                          <span className=\"font-bold\">FREE</span>\r\n                        </div>\r\n                      )}\r\n                      {appliedDiscount > 0 && (\r\n                        <div className=\"flex justify-between text-green-600\">\r\n                          <span>Deal Savings</span>\r\n                          <span className=\"font-bold\">\r\n                            -${appliedDiscount.toFixed(2)}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                      {blindShipmentEnabled && (\r\n                        <div className=\"flex justify-between text-orange-600\">\r\n                          <span>Blind Shipment Fee</span>\r\n                          <span>+${orderData.blindShipmentFee.toFixed(2)}</span>\r\n                        </div>\r\n                      )}\r\n                      {orderData.additionalPayment > 0 && (\r\n                        <div className=\"flex justify-between text-orange-600\">\r\n                          <span>Additional Payment</span>\r\n                          <span>\r\n                            +${orderData.additionalPayment.toFixed(2)}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                      {/* Store Credit Applied display disabled temporarily */}\r\n                    </div>\r\n\r\n                    <div className=\"flex justify-between items-center mb-6 text-xl font-bold\">\r\n                      <span>Total</span>\r\n                      <span>${orderData.total.toFixed(2)}</span>\r\n                    </div>\r\n\r\n                    {/* Store credit earned display disabled temporarily */}\r\n                  </div>\r\n\r\n                  {/* Store credit section disabled temporarily */}\r\n\r\n                  <ShippingOptionsSelector\r\n                    selectedOptionId={selectedShippingOptionId}\r\n                    onSelectionChange={(\r\n                      optionId,\r\n                      cost,\r\n                      deliveryDate,\r\n                      optionName,\r\n                    ) => {\r\n                      setSelectedShippingOptionId(optionId);\r\n                      setShippingCost(cost);\r\n                      setEstimatedDeliveryDate(deliveryDate);\r\n                      setShippingOptionName(optionName);\r\n                      calculateOrderData(\r\n                        orderData.subtotal,\r\n                        appliedDiscount,\r\n                        appliedStoreCredit,\r\n                        cost,\r\n                      );\r\n                    }}\r\n                  />\r\n\r\n                  {estimatedDeliveryDate && (\r\n                    <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-6\">\r\n                      <h4 className=\"text-gray-900 font-bold mb-4 flex items-center gap-2\">\r\n                         Estimated Delivery\r\n                      </h4>\r\n                      <div className=\"border-t border-gray-200 pt-3 flex justify-between font-bold text-lg\">\r\n                        <span>Delivery by</span>\r\n                        <span className=\"text-green-600\">\r\n                          {new Date(estimatedDeliveryDate).toLocaleDateString(\r\n                            \"en-US\",\r\n                            {\r\n                              weekday: \"short\",\r\n                              month: \"short\",\r\n                              day: \"numeric\",\r\n                            },\r\n                          )}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-xs text-gray-500 mt-3\">\r\n                        * Delivery may not occur on weekends. Dates are\r\n                        automatically moved to the next business day.\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {showPaymentForm && createdOrderId ? (\r\n                    <div className=\"mb-3\">\r\n                      <SquarePaymentForm\r\n                        amount={orderData.total}\r\n                        orderId={createdOrderId}\r\n                        customerEmail={customerInfo.email}\r\n                        customerName={`${customerInfo.firstName} ${customerInfo.lastName}`}\r\n                        onPaymentSuccess={handlePaymentSuccess}\r\n                        isLoading={isSubmitting}\r\n                      />\r\n\r\n                      {/* PCI DSS Compliance Badge */}\r\n                      <div className=\"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center gap-3\">\r\n                        <div className=\"flex-shrink-0\">\r\n                          <svg\r\n                            className=\"w-5 h-5 text-green-600\"\r\n                            fill=\"currentColor\"\r\n                            viewBox=\"0 0 20 20\"\r\n                          >\r\n                            <path\r\n                              fillRule=\"evenodd\"\r\n                              d=\"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z\"\r\n                              clipRule=\"evenodd\"\r\n                            />\r\n                          </svg>\r\n                        </div>\r\n                        <div>\r\n                          <p className=\"text-sm font-semibold text-green-900\">\r\n                            PCI DSS Level 1 Compliant\r\n                          </p>\r\n                          <p className=\"text-xs text-green-700\">\r\n                            Your payment information is processed securely by\r\n                            Square Payment Systems, certified to PCI DSS Level 1\r\n                            standards.\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      <Button\r\n                        type=\"submit\"\r\n                        disabled={\r\n                          isSubmitting ||\r\n                          !agreedToPolicy ||\r\n                          !agreedToPrivacy ||\r\n                          !agreedToTerms ||\r\n                          !agreedToShippingPolicy\r\n                        }\r\n                        className=\"w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-6 text-lg font-bold rounded-lg mb-3 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                      >\r\n                        {isSubmitting ? (\r\n                          <>\r\n                            <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                            Processing...\r\n                          </>\r\n                        ) : (\r\n                          <> Go to Checkout</>\r\n                        )}\r\n                      </Button>\r\n\r\n                      {/* PCI DSS Compliance Notice */}\r\n                      <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\r\n                        <p className=\"text-xs text-blue-800\">\r\n                          {\" \"}\r\n                          <span className=\"font-semibold\">\r\n                            Payment Security:\r\n                          </span>{\" \"}\r\n                          Your payment information will be processed securely by\r\n                          Square Payment Systems, which is PCI DSS Level 1\r\n                          certified. We never store your credit card information\r\n                          on our servers.\r\n                        </p>\r\n                      </div>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </main>\r\n    </>\r\n  );\r\n}\r\n","import { useEffect, useState } from \"react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\n\r\ninterface CheckoutFormProps {\r\n  customerInfo: {\r\n    email: string;\r\n    firstName: string;\r\n    lastName: string;\r\n    phone: string;\r\n    street: string;\r\n    street2: string;\r\n    city: string;\r\n    state: string;\r\n    postalCode: string;\r\n    country: string;\r\n  };\r\n  billingInfo: {\r\n    sameAsShipping: boolean;\r\n    firstName: string;\r\n    lastName: string;\r\n    street: string;\r\n    street2: string;\r\n    city: string;\r\n    state: string;\r\n    postalCode: string;\r\n    country: string;\r\n  };\r\n  onCustomerChange: (field: string, value: string) => void;\r\n  onBillingChange: (field: string, value: string | boolean) => void;\r\n}\r\n\r\nconst COUNTRIES = [\r\n  { code: \"US\", name: \"United States\" },\r\n  { code: \"CA\", name: \"Canada\" },\r\n  { code: \"GB\", name: \"United Kingdom\" },\r\n  { code: \"AU\", name: \"Australia\" },\r\n];\r\n\r\nconst US_STATES = [\r\n  \"AL\",\r\n  \"AK\",\r\n  \"AZ\",\r\n  \"AR\",\r\n  \"CA\",\r\n  \"CO\",\r\n  \"CT\",\r\n  \"DE\",\r\n  \"FL\",\r\n  \"GA\",\r\n  \"HI\",\r\n  \"ID\",\r\n  \"IL\",\r\n  \"IN\",\r\n  \"IA\",\r\n  \"KS\",\r\n  \"KY\",\r\n  \"LA\",\r\n  \"ME\",\r\n  \"MD\",\r\n  \"MA\",\r\n  \"MI\",\r\n  \"MN\",\r\n  \"MS\",\r\n  \"MO\",\r\n  \"MT\",\r\n  \"NE\",\r\n  \"NV\",\r\n  \"NH\",\r\n  \"NJ\",\r\n  \"NM\",\r\n  \"NY\",\r\n  \"NC\",\r\n  \"ND\",\r\n  \"OH\",\r\n  \"OK\",\r\n  \"OR\",\r\n  \"PA\",\r\n  \"RI\",\r\n  \"SC\",\r\n  \"SD\",\r\n  \"TN\",\r\n  \"TX\",\r\n  \"UT\",\r\n  \"VT\",\r\n  \"VA\",\r\n  \"WA\",\r\n  \"WV\",\r\n  \"WI\",\r\n  \"WY\",\r\n];\r\n\r\ninterface SavedAddress {\r\n  id: number;\r\n  first_name: string;\r\n  last_name: string;\r\n  street_1: string;\r\n  street_2?: string;\r\n  city: string;\r\n  state_or_province: string;\r\n  postal_code: string;\r\n  country_code: string;\r\n}\r\n\r\nexport default function CheckoutForm({\r\n  customerInfo,\r\n  billingInfo,\r\n  onCustomerChange,\r\n  onBillingChange,\r\n}: CheckoutFormProps) {\r\n  const [savedAddresses, setSavedAddresses] = useState<SavedAddress[]>([]);\r\n  const [isLoadingAddresses, setIsLoadingAddresses] = useState(false);\r\n  const [selectedSavedAddressId, setSelectedSavedAddressId] = useState<\r\n    number | null\r\n  >(null);\r\n\r\n  useEffect(() => {\r\n    const loadSavedAddresses = async () => {\r\n      const token = localStorage.getItem(\"authToken\");\r\n      if (!token) return;\r\n\r\n      try {\r\n        setIsLoadingAddresses(true);\r\n        const response = await fetch(\"/api/customers/me/addresses\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        if (response.ok) {\r\n          const data = await response.json();\r\n          setSavedAddresses(data.addresses || []);\r\n\r\n          // Auto-select first address\r\n          if (data.addresses && data.addresses.length > 0) {\r\n            const firstAddress = data.addresses[0];\r\n            setSelectedSavedAddressId(firstAddress.id);\r\n            onCustomerChange(\"firstName\", firstAddress.first_name);\r\n            onCustomerChange(\"lastName\", firstAddress.last_name);\r\n            onCustomerChange(\"street\", firstAddress.street_1);\r\n            onCustomerChange(\"street2\", firstAddress.street_2 || \"\");\r\n            onCustomerChange(\"city\", firstAddress.city);\r\n            onCustomerChange(\"state\", firstAddress.state_or_province);\r\n            onCustomerChange(\"postalCode\", firstAddress.postal_code);\r\n\r\n            // Validate country code against allowed values\r\n            const validCountryCode = COUNTRIES.some(c => c.code === firstAddress.country_code)\r\n              ? firstAddress.country_code\r\n              : \"US\";\r\n            onCustomerChange(\"country\", validCountryCode);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error loading saved addresses:\", error);\r\n      } finally {\r\n        setIsLoadingAddresses(false);\r\n      }\r\n    };\r\n\r\n    loadSavedAddresses();\r\n  }, []);\r\n\r\n  const handleSelectAddress = (addressId: number) => {\r\n    const address = savedAddresses.find((a) => a.id === addressId);\r\n    if (!address) return;\r\n\r\n    setSelectedSavedAddressId(addressId);\r\n    onCustomerChange(\"firstName\", address.first_name);\r\n    onCustomerChange(\"lastName\", address.last_name);\r\n    onCustomerChange(\"street\", address.street_1);\r\n    onCustomerChange(\"street2\", address.street_2 || \"\");\r\n    onCustomerChange(\"city\", address.city);\r\n    onCustomerChange(\"state\", address.state_or_province);\r\n    onCustomerChange(\"postalCode\", address.postal_code);\r\n\r\n    // Validate country code against allowed values\r\n    const validCountryCode = COUNTRIES.some(c => c.code === address.country_code)\r\n      ? address.country_code\r\n      : \"US\";\r\n    onCustomerChange(\"country\", validCountryCode);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Saved Addresses */}\r\n      {savedAddresses.length > 0 && (\r\n        <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-6\">\r\n          <h3 className=\"text-xl font-bold mb-6\">Saved Addresses</h3>\r\n          <div className=\"space-y-2 mb-4\">\r\n            {savedAddresses.map((address) => (\r\n              <button\r\n                key={address.id}\r\n                onClick={() => handleSelectAddress(address.id)}\r\n                className={`w-full text-left p-4 rounded-lg border-2 transition-colors ${\r\n                  selectedSavedAddressId === address.id\r\n                    ? \"border-blue-600 bg-blue-50\"\r\n                    : \"border-gray-200 hover:border-gray-300 bg-gray-50\"\r\n                }`}\r\n              >\r\n                <p className=\"font-semibold text-gray-900\">\r\n                  {address.first_name} {address.last_name}\r\n                </p>\r\n                <p className=\"text-gray-700 text-sm\">{address.street_1}</p>\r\n                {address.street_2 && (\r\n                  <p className=\"text-gray-700 text-sm\">{address.street_2}</p>\r\n                )}\r\n                <p className=\"text-gray-700 text-sm\">\r\n                  {address.city}, {address.state_or_province}{\" \"}\r\n                  {address.postal_code}\r\n                </p>\r\n              </button>\r\n            ))}\r\n          </div>\r\n          <p className=\"text-gray-600 text-sm mb-6\">\r\n            Or enter a different address below:\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Shipping Information */}\r\n      <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-4 sm:p-6\">\r\n        <h3 className=\"text-lg sm:text-xl font-bold mb-4 sm:mb-6\">Shipping Address</h3>\r\n\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4\">\r\n          <div>\r\n            <Label htmlFor=\"shipping-first-name\" className=\"text-gray-700\">\r\n              First Name <span aria-label=\"required\">*</span>\r\n            </Label>\r\n            <Input\r\n              id=\"shipping-first-name\"\r\n              value={customerInfo.firstName}\r\n              onChange={(e) => onCustomerChange(\"firstName\", e.target.value)}\r\n              className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-2\"\r\n              required\r\n              aria-required=\"true\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"shipping-last-name\" className=\"text-gray-700\">\r\n              Last Name <span aria-label=\"required\">*</span>\r\n            </Label>\r\n            <Input\r\n              id=\"shipping-last-name\"\r\n              value={customerInfo.lastName}\r\n              onChange={(e) => onCustomerChange(\"lastName\", e.target.value)}\r\n              className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-2\"\r\n              required\r\n              aria-required=\"true\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mb-3 sm:mb-4\">\r\n          <Label htmlFor=\"shipping-email\" className=\"text-sm sm:text-gray-700\">\r\n            Email Address <span aria-label=\"required\">*</span>\r\n          </Label>\r\n          <Input\r\n            id=\"shipping-email\"\r\n            type=\"email\"\r\n            value={customerInfo.email}\r\n            onChange={(e) => onCustomerChange(\"email\", e.target.value)}\r\n            className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n            required\r\n            aria-required=\"true\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"mb-3 sm:mb-4\">\r\n          <Label htmlFor=\"shipping-phone\" className=\"text-sm sm:text-gray-700\">\r\n            Phone Number <span aria-label=\"required\">*</span>\r\n          </Label>\r\n          <Input\r\n            id=\"shipping-phone\"\r\n            type=\"tel\"\r\n            value={customerInfo.phone}\r\n            onChange={(e) => onCustomerChange(\"phone\", e.target.value)}\r\n            className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n            required\r\n            aria-required=\"true\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"mb-3 sm:mb-4\">\r\n          <Label htmlFor=\"shipping-street\" className=\"text-sm sm:text-gray-700\">\r\n            Street Address <span aria-label=\"required\">*</span>\r\n          </Label>\r\n          <Input\r\n            id=\"shipping-street\"\r\n            value={customerInfo.street}\r\n            onChange={(e) => onCustomerChange(\"street\", e.target.value)}\r\n            placeholder=\"123 Main St\"\r\n            className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n            required\r\n            aria-required=\"true\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"mb-3 sm:mb-4\">\r\n          <Label htmlFor=\"shipping-street2\" className=\"text-sm sm:text-gray-700\">\r\n            Apt, Suite, etc. (optional)\r\n          </Label>\r\n          <Input\r\n            id=\"shipping-street2\"\r\n            value={customerInfo.street2}\r\n            onChange={(e) => onCustomerChange(\"street2\", e.target.value)}\r\n            placeholder=\"Apt 4B\"\r\n            className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4\">\r\n          <div>\r\n            <Label className=\"text-sm sm:text-gray-700\">City *</Label>\r\n            <Input\r\n              value={customerInfo.city}\r\n              onChange={(e) => onCustomerChange(\"city\", e.target.value)}\r\n              className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n              required\r\n            />\r\n          </div>\r\n          <div>\r\n            <Label className=\"text-sm sm:text-gray-700\">Postal Code *</Label>\r\n            <Input\r\n              value={customerInfo.postalCode}\r\n              onChange={(e) => onCustomerChange(\"postalCode\", e.target.value)}\r\n              className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n              required\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\r\n          <div>\r\n            <Label className=\"text-sm sm:text-gray-700\">Country *</Label>\r\n            <Select\r\n              value={customerInfo.country}\r\n              onValueChange={(value) => onCustomerChange(\"country\", value)}\r\n            >\r\n              <SelectTrigger className=\"bg-gray-50 border-gray-200 text-gray-900 mt-1 sm:mt-2\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent className=\"bg-white border-gray-200\">\r\n                {COUNTRIES.map((country) => (\r\n                  <SelectItem\r\n                    key={country.code}\r\n                    value={country.code}\r\n                    className=\"text-gray-900 hover:bg-gray-100\"\r\n                  >\r\n                    {country.name}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n          <div>\r\n            <Label className=\"text-sm sm:text-gray-700\">State/Province *</Label>\r\n            {customerInfo.country === \"US\" ? (\r\n              <Select\r\n                value={customerInfo.state}\r\n                onValueChange={(value) => onCustomerChange(\"state\", value)}\r\n              >\r\n                <SelectTrigger className=\"bg-gray-50 border-gray-200 text-gray-900 mt-1 sm:mt-2\">\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent className=\"bg-white border-gray-200 max-h-60\">\r\n                  {US_STATES.map((state) => (\r\n                    <SelectItem\r\n                      key={state}\r\n                      value={state}\r\n                      className=\"text-gray-900 hover:bg-gray-100\"\r\n                    >\r\n                      {state}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            ) : (\r\n              <Input\r\n                value={customerInfo.state}\r\n                onChange={(e) => onCustomerChange(\"state\", e.target.value)}\r\n                placeholder=\"State/Province\"\r\n                className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                required\r\n              />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Billing Information */}\r\n      <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-2xl p-4 sm:p-6\">\r\n        <h3 className=\"text-lg sm:text-xl font-bold mb-4 sm:mb-6\">Billing Address</h3>\r\n\r\n        <div className=\"flex items-center gap-3 mb-4 sm:mb-6\">\r\n          <input\r\n            type=\"checkbox\"\r\n            id=\"sameAsShipping\"\r\n            checked={billingInfo.sameAsShipping}\r\n            onChange={(e) =>\r\n              onBillingChange(\"sameAsShipping\", e.target.checked)\r\n            }\r\n            className=\"w-5 h-5 rounded bg-gray-50 border-gray-200\"\r\n          />\r\n          <Label\r\n            htmlFor=\"sameAsShipping\"\r\n            className=\"text-sm sm:text-gray-700 cursor-pointer font-normal\"\r\n          >\r\n            Same as shipping address\r\n          </Label>\r\n        </div>\r\n\r\n        {!billingInfo.sameAsShipping && (\r\n          <>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4\">\r\n              <div>\r\n                <Label className=\"text-sm sm:text-gray-700\">First Name *</Label>\r\n                <Input\r\n                  value={billingInfo.firstName}\r\n                  onChange={(e) => onBillingChange(\"firstName\", e.target.value)}\r\n                  className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                  required\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label className=\"text-sm sm:text-gray-700\">Last Name *</Label>\r\n                <Input\r\n                  value={billingInfo.lastName}\r\n                  onChange={(e) => onBillingChange(\"lastName\", e.target.value)}\r\n                  className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                  required\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mb-3 sm:mb-4\">\r\n              <Label className=\"text-sm sm:text-gray-700\">Street Address *</Label>\r\n              <Input\r\n                value={billingInfo.street}\r\n                onChange={(e) => onBillingChange(\"street\", e.target.value)}\r\n                placeholder=\"123 Main St\"\r\n                className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className=\"mb-3 sm:mb-4\">\r\n              <Label className=\"text-sm sm:text-gray-700\">\r\n                Apt, Suite, etc. (optional)\r\n              </Label>\r\n              <Input\r\n                value={billingInfo.street2}\r\n                onChange={(e) => onBillingChange(\"street2\", e.target.value)}\r\n                placeholder=\"Apt 4B\"\r\n                className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4\">\r\n              <div>\r\n                <Label className=\"text-sm sm:text-gray-700\">City *</Label>\r\n                <Input\r\n                  value={billingInfo.city}\r\n                  onChange={(e) => onBillingChange(\"city\", e.target.value)}\r\n                  className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                  required\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label className=\"text-sm sm:text-gray-700\">Postal Code *</Label>\r\n                <Input\r\n                  value={billingInfo.postalCode}\r\n                  onChange={(e) =>\r\n                    onBillingChange(\"postalCode\", e.target.value)\r\n                  }\r\n                  className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                  required\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4\">\r\n              <div>\r\n                <Label className=\"text-sm sm:text-gray-700\">Country *</Label>\r\n                <Select\r\n                  value={billingInfo.country}\r\n                  onValueChange={(value) => onBillingChange(\"country\", value)}\r\n                >\r\n                  <SelectTrigger className=\"bg-gray-50 border-gray-200 text-gray-900 mt-1 sm:mt-2\">\r\n                    <SelectValue />\r\n                  </SelectTrigger>\r\n                  <SelectContent className=\"bg-white border-gray-200\">\r\n                    {COUNTRIES.map((country) => (\r\n                      <SelectItem\r\n                        key={country.code}\r\n                        value={country.code}\r\n                        className=\"text-gray-900 hover:bg-gray-100\"\r\n                      >\r\n                        {country.name}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              <div>\r\n                <Label className=\"text-sm sm:text-gray-700\">State/Province *</Label>\r\n                {billingInfo.country === \"US\" ? (\r\n                  <Select\r\n                    value={billingInfo.state}\r\n                    onValueChange={(value) => onBillingChange(\"state\", value)}\r\n                  >\r\n                    <SelectTrigger className=\"bg-gray-50 border-gray-200 text-gray-900 mt-1 sm:mt-2\">\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-white border-gray-200 max-h-60\">\r\n                      {US_STATES.map((state) => (\r\n                        <SelectItem\r\n                          key={state}\r\n                          value={state}\r\n                          className=\"text-gray-900 hover:bg-gray-100\"\r\n                        >\r\n                          {state}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                ) : (\r\n                  <Input\r\n                    value={billingInfo.state}\r\n                    onChange={(e) => onBillingChange(\"state\", e.target.value)}\r\n                    placeholder=\"State/Province\"\r\n                    className=\"bg-gray-50 border-gray-200 text-gray-900 placeholder-gray-400 mt-1 sm:mt-2\"\r\n                    required\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useState, useEffect } from \"react\";\r\nimport { Truck, AlertCircle, ChevronDown } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface ShippingOption {\r\n  id: number;\r\n  name: string;\r\n  description?: string;\r\n  cost: number;\r\n  processing_time_days: number;\r\n  estimated_delivery_days_min: number;\r\n  estimated_delivery_days_max: number;\r\n  is_active: boolean;\r\n}\r\n\r\ninterface ShippingOptionsSelectorProps {\r\n  selectedOptionId: number | null;\r\n  onSelectionChange: (\r\n    optionId: number,\r\n    cost: number,\r\n    estimatedDeliveryDate: string,\r\n    shippingOptionName: string,\r\n  ) => void;\r\n}\r\n\r\nexport default function ShippingOptionsSelector({\r\n  selectedOptionId,\r\n  onSelectionChange,\r\n}: ShippingOptionsSelectorProps) {\r\n  const [shippingOptions, setShippingOptions] = useState<ShippingOption[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expandedOptionId, setExpandedOptionId] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchShippingOptions = async () => {\r\n      const maxRetries = 3;\r\n      let lastError: Error | null = null;\r\n\r\n      for (let attempt = 1; attempt <= maxRetries; attempt++) {\r\n        try {\r\n          const apiUrl = `/api/shipping-options`;\r\n          console.log(\r\n            `Attempting to fetch shipping options (attempt ${attempt}/${maxRetries}) from:`,\r\n            apiUrl,\r\n          );\r\n\r\n          const controller = new AbortController();\r\n          // Increase timeout to 30 seconds for production deployments\r\n          const timeoutId = setTimeout(() => controller.abort(), 30000);\r\n\r\n          try {\r\n            console.log(\"Starting fetch request for shipping options...\");\r\n            const response = await fetch(apiUrl, {\r\n              method: \"GET\",\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n              },\r\n              signal: controller.signal,\r\n            }).catch((err) => {\r\n              // Network error - provide more details\r\n              console.error(\"Network/CORS error details:\", {\r\n                message: err.message,\r\n                type: err.constructor.name,\r\n                stack: err.stack,\r\n              });\r\n              throw err;\r\n            });\r\n\r\n            clearTimeout(timeoutId);\r\n            console.log(\"Shipping options response status:\", response.status);\r\n\r\n            if (!response.ok) {\r\n              const errorData = await response.json().catch(() => ({}));\r\n              const errorMsg = errorData.error || `HTTP ${response.status}`;\r\n              throw new Error(`Failed to fetch shipping options: ${errorMsg}`);\r\n            }\r\n\r\n            const data = await response.json();\r\n            const options = data.data || [];\r\n\r\n            console.log(\r\n              \"Shipping options loaded successfully:\",\r\n              options.length,\r\n            );\r\n            setShippingOptions(options);\r\n            setError(null);\r\n            setIsLoading(false);\r\n\r\n            if (options.length > 0 && !selectedOptionId) {\r\n              const defaultOption = options[0];\r\n              const estimatedDate =\r\n                calculateEstimatedDeliveryDate(defaultOption);\r\n              onSelectionChange(\r\n                defaultOption.id,\r\n                defaultOption.cost,\r\n                estimatedDate,\r\n                defaultOption.name,\r\n              );\r\n            }\r\n\r\n            // Success - exit retry loop\r\n            return;\r\n          } catch (fetchErr) {\r\n            clearTimeout(timeoutId);\r\n            if (fetchErr instanceof Error && fetchErr.name === \"AbortError\") {\r\n              lastError = new Error(\r\n                \"Request timeout: Shipping options are taking too long to load\",\r\n              );\r\n            } else {\r\n              lastError =\r\n                fetchErr instanceof Error\r\n                  ? fetchErr\r\n                  : new Error(String(fetchErr));\r\n            }\r\n\r\n            console.warn(`Attempt ${attempt} failed:`, lastError.message);\r\n\r\n            // Wait before retrying (exponential backoff)\r\n            if (attempt < maxRetries) {\r\n              const delayMs = Math.min(1000 * Math.pow(2, attempt - 1), 5000);\r\n              console.log(`Retrying in ${delayMs}ms...`);\r\n              await new Promise((resolve) => setTimeout(resolve, delayMs));\r\n            }\r\n\r\n            throw lastError;\r\n          }\r\n        } catch (err) {\r\n          lastError = err instanceof Error ? err : new Error(String(err));\r\n\r\n          if (attempt === maxRetries) {\r\n            // Final attempt failed - show error to user\r\n            console.error(\"All fetch attempts failed:\", lastError);\r\n            const errorMsg =\r\n              lastError.message || \"Failed to load shipping options\";\r\n            console.error(\"Full error details:\", {\r\n              error: err,\r\n              message: errorMsg,\r\n              type: lastError.constructor.name,\r\n              stack: lastError.stack,\r\n            });\r\n\r\n            // Provide user-friendly error message based on error type\r\n            let displayError = errorMsg;\r\n            if (\r\n              errorMsg.includes(\"Failed to fetch\") ||\r\n              errorMsg.includes(\"NetworkError\")\r\n            ) {\r\n              displayError =\r\n                \"Network error: Unable to reach the server. Please check your connection and try again.\";\r\n            }\r\n\r\n            setError(displayError);\r\n            setIsLoading(false);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    fetchShippingOptions();\r\n  }, []);\r\n\r\n  const calculateEstimatedDeliveryDate = (option: ShippingOption): string => {\r\n    // Use MAX delivery days for conservative estimate (worst-case scenario)\r\n    const totalDays =\r\n      option.processing_time_days + option.estimated_delivery_days_max;\r\n    const deliveryDate = new Date();\r\n    deliveryDate.setDate(deliveryDate.getDate() + totalDays);\r\n    return deliveryDate.toISOString().split(\"T\")[0];\r\n  };\r\n\r\n  const calculateDeliveryDateRange = (\r\n    option: ShippingOption,\r\n  ): { min: string; max: string } => {\r\n    const minTotalDays =\r\n      option.processing_time_days + option.estimated_delivery_days_min;\r\n    const maxTotalDays =\r\n      option.processing_time_days + option.estimated_delivery_days_max;\r\n\r\n    const minDate = new Date();\r\n    minDate.setDate(minDate.getDate() + minTotalDays);\r\n\r\n    const maxDate = new Date();\r\n    maxDate.setDate(maxDate.getDate() + maxTotalDays);\r\n\r\n    return {\r\n      min: minDate.toISOString().split(\"T\")[0],\r\n      max: maxDate.toISOString().split(\"T\")[0],\r\n    };\r\n  };\r\n\r\n  const handleSelectOption = (option: ShippingOption) => {\r\n    const estimatedDate = calculateEstimatedDeliveryDate(option);\r\n    onSelectionChange(option.id, option.cost, estimatedDate, option.name);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-lg p-4\">\r\n        <h4 className=\"text-gray-900 font-bold mb-2 text-sm flex items-center gap-2\">\r\n          <Truck className=\"w-4 h-4\" />\r\n          Shipping\r\n        </h4>\r\n        <div className=\"flex items-center justify-center py-4\">\r\n          <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\" />\r\n          <span className=\"ml-2 text-gray-600 text-xs\">Loading...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-lg p-4\">\r\n        <h4 className=\"text-gray-900 font-bold mb-2 text-sm flex items-center gap-2\">\r\n          <Truck className=\"w-4 h-4\" />\r\n          Shipping\r\n        </h4>\r\n        <div className=\"flex items-start gap-2 bg-red-500/20 border border-red-500/50 rounded p-3\">\r\n          <AlertCircle className=\"w-4 h-4 text-red-400 flex-shrink-0 mt-0.5\" />\r\n          <div className=\"flex-1\">\r\n            <p className=\"text-red-400 text-xs font-medium mb-1\">{error}</p>\r\n            <p className=\"text-red-400/70 text-xs\">\r\n              Shipping costs will be calculated during checkout. You can\r\n              continue without selecting an option.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (shippingOptions.length === 0) {\r\n    return (\r\n      <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-lg p-4\">\r\n        <h4 className=\"text-gray-900 font-bold mb-2 text-sm flex items-center gap-2\">\r\n          <Truck className=\"w-4 h-4\" />\r\n          Shipping\r\n        </h4>\r\n        <p className=\"text-gray-600 text-xs\">\r\n          No options available. Costs will be calculated at checkout.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"backdrop-blur-xl bg-white border border-gray-200 rounded-lg p-4\">\r\n      <h4 className=\"text-gray-900 font-bold mb-2 text-sm flex items-center gap-2\">\r\n        <Truck className=\"w-4 h-4\" />\r\n        Shipping\r\n      </h4>\r\n\r\n      <div className=\"space-y-2\">\r\n        {shippingOptions.map((option) => {\r\n          const { min: minDate, max: maxDate } =\r\n            calculateDeliveryDateRange(option);\r\n\r\n          const minDateObj = new Date(minDate);\r\n          const maxDateObj = new Date(maxDate);\r\n\r\n          const formattedMinDate = minDateObj.toLocaleDateString(\"en-US\", {\r\n            month: \"short\",\r\n            day: \"numeric\",\r\n          });\r\n\r\n          const formattedMaxDate = maxDateObj.toLocaleDateString(\"en-US\", {\r\n            weekday: \"short\",\r\n            month: \"short\",\r\n            day: \"numeric\",\r\n          });\r\n\r\n          const isExpanded = expandedOptionId === option.id;\r\n          const isSelected = selectedOptionId === option.id;\r\n\r\n          return (\r\n            <div\r\n              key={option.id}\r\n              className=\"overflow-hidden rounded-lg border border-gray-200\"\r\n            >\r\n              <button\r\n                onClick={() => {\r\n                  setExpandedOptionId(isExpanded ? null : option.id);\r\n                  if (!isSelected) {\r\n                    handleSelectOption(option);\r\n                  }\r\n                }}\r\n                className={`w-full flex items-center gap-2 p-3 transition-all text-sm ${\r\n                  isSelected\r\n                    ? \"bg-blue-50 border-blue-600/50\"\r\n                    : \"bg-white/5 hover:bg-gray-50\"\r\n                }`}\r\n              >\r\n                <input\r\n                  type=\"radio\"\r\n                  name=\"shipping-option\"\r\n                  value={option.id}\r\n                  checked={isSelected}\r\n                  onChange={() => handleSelectOption(option)}\r\n                  className=\"w-4 h-4 cursor-pointer flex-shrink-0\"\r\n                />\r\n\r\n                <div className=\"flex-1 text-left min-w-0\">\r\n                  <div className=\"flex items-baseline justify-between gap-2\">\r\n                    <p className=\"text-gray-900 font-semibold truncate\">\r\n                      {option.name}\r\n                    </p>\r\n                    <span className=\"text-gray-900 font-bold flex-shrink-0 whitespace-nowrap\">\r\n                      ${option.cost.toFixed(2)}\r\n                    </span>\r\n                  </div>\r\n                  <p className=\"text-xs text-gray-600 line-clamp-1\">\r\n                    {option.processing_time_days}d +{\" \"}\r\n                    {option.estimated_delivery_days_min}-\r\n                    {option.estimated_delivery_days_max}d = {formattedMinDate}{\" \"}\r\n                    to {formattedMaxDate}\r\n                  </p>\r\n                </div>\r\n\r\n                <ChevronDown\r\n                  className={`w-4 h-4 text-gray-900/40 flex-shrink-0 transition-transform ${\r\n                    isExpanded ? \"rotate-180\" : \"\"\r\n                  }`}\r\n                />\r\n              </button>\r\n\r\n              {isExpanded && (\r\n                <div className=\"border-t border-gray-200 bg-white/5 p-3 space-y-3 text-xs text-gray-900/70\">\r\n                  <div className=\"space-y-2\">\r\n                    <h5 className=\"font-semibold text-gray-900 text-sm\">\r\n                      Timing Breakdown\r\n                    </h5>\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"flex justify-between\">\r\n                        <span>Processing</span>\r\n                        <span className=\"text-gray-900 font-medium\">\r\n                          {option.processing_time_days} day\r\n                          {option.processing_time_days !== 1 ? \"s\" : \"\"}\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"flex justify-between\">\r\n                        <span>Shipping</span>\r\n                        <span className=\"text-gray-900 font-medium\">\r\n                          {option.estimated_delivery_days_min}-\r\n                          {option.estimated_delivery_days_max} days\r\n                        </span>\r\n                      </div>\r\n                      <div className=\"border-t border-gray-200 pt-1 flex justify-between\">\r\n                        <span>Total</span>\r\n                        <span className=\"text-gray-900 font-medium\">\r\n                          {option.processing_time_days +\r\n                            option.estimated_delivery_days_min}\r\n                          -\r\n                          {option.processing_time_days +\r\n                            option.estimated_delivery_days_max}{\" \"}\r\n                          days\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-1 border-t border-gray-200 pt-2\">\r\n                    <h5 className=\"font-semibold text-gray-900 text-sm\">\r\n                      Estimated Delivery\r\n                    </h5>\r\n                    <div className=\"flex justify-between\">\r\n                      <span>Earliest</span>\r\n                      <span className=\"text-green-400 font-medium\">\r\n                        {formattedMinDate}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"flex justify-between\">\r\n                      <span>Latest</span>\r\n                      <span className=\"text-green-400 font-medium\">\r\n                        {formattedMaxDate}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {option.description && (\r\n                    <div className=\"border-t border-gray-200 pt-2\">\r\n                      <h5 className=\"font-semibold text-gray-900 text-sm mb-1\">\r\n                        Details\r\n                      </h5>\r\n                      <p className=\"text-gray-600\">{option.description}</p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useEffect, useRef } from \"react\";\r\n\r\ninterface SquarePaymentFormProps {\r\n  amount: number;\r\n  orderId: number;\r\n  customerEmail: string;\r\n  customerName: string;\r\n  onPaymentSuccess: (token: string) => void;\r\n  isLoading?: boolean;\r\n  applicationId?: string;\r\n}\r\n\r\nexport default function SquarePaymentForm({\r\n  amount,\r\n  orderId,\r\n  customerEmail,\r\n  customerName,\r\n  onPaymentSuccess,\r\n  isLoading = false,\r\n  applicationId,\r\n}: SquarePaymentFormProps) {\r\n  const initializeRef = useRef(false);\r\n\r\n  useEffect(() => {\r\n    if (initializeRef.current) return;\r\n\r\n    const initializePayments = async () => {\r\n      try {\r\n        // Wait for Square SDK to be loaded\r\n        let attempts = 0;\r\n        while (!(window as any).Square && attempts < 100) {\r\n          await new Promise((resolve) => setTimeout(resolve, 100));\r\n          attempts++;\r\n        }\r\n\r\n        if (!(window as any).Square) {\r\n          console.error(\r\n            \"Square SDK not loaded after timeout - check CSP headers and network\",\r\n          );\r\n          const statusContainer = document.getElementById(\r\n            \"payment-status-container\",\r\n          );\r\n          if (statusContainer) {\r\n            statusContainer.innerHTML = `<div class=\"text-red-600\">Square SDK failed to load. Check browser console for details.</div>`;\r\n          }\r\n          return;\r\n        }\r\n\r\n        console.log(\r\n          \"Square SDK loaded successfully after\",\r\n          attempts,\r\n          \"attempts\",\r\n        );\r\n        initializeRef.current = true;\r\n\r\n        const appId = import.meta.env.VITE_SQUARE_APP_ID;\n        const locationId = import.meta.env.VITE_SQUARE_LOCATION_ID;\n\n        if (!appId || !locationId) {\n          console.error(\"Square credentials not configured\");\n          const statusContainer = document.getElementById(\n            \"payment-status-container\",\n          );\n          if (statusContainer) {\n            statusContainer.innerHTML = '<div class=\"text-red-600\">Payment system not configured. Please contact support.</div>';\n          }\n          return;\n        }\n\r\n        const payments = (window as any).Square.payments(appId, locationId);\r\n\r\n        console.log(\"Square payments object created with appId:\", appId);\r\n\r\n        const card = await payments.card();\r\n        console.log(\"Card object created\");\r\n\r\n        const cardContainer = document.getElementById(\"card-container\");\r\n        if (!cardContainer) {\r\n          throw new Error(\r\n            \"Card container element (#card-container) not found in DOM\",\r\n          );\r\n        }\r\n\r\n        await card.attach(\"#card-container\");\r\n        console.log(\"Card attached to container successfully\");\r\n\r\n        const cardButton = document.getElementById(\"card-button\");\r\n        if (cardButton) {\r\n          cardButton.addEventListener(\"click\", async () => {\r\n            const statusContainer = document.getElementById(\r\n              \"payment-status-container\",\r\n            );\r\n\r\n            try {\r\n              if (statusContainer) {\r\n                statusContainer.innerHTML =\r\n                  '<div class=\"text-gray-900\">Processing payment...</div>';\r\n              }\r\n\r\n              const result = await card.tokenize();\r\n              if (result.status === \"OK\") {\r\n                console.log(`Payment token is ${result.token}`);\r\n\r\n                if (statusContainer) {\r\n                  statusContainer.innerHTML =\r\n                    '<div class=\"text-gray-900\">Sending payment to Square...</div>';\r\n                }\r\n\r\n                // Send token to backend to create payment using Square's Payments API (POST /v2/payments)\r\n                const response = await fetch(\"/api/square/create-payment\", {\r\n                  method: \"POST\",\r\n                  headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                  },\r\n                  body: JSON.stringify({\r\n                    sourceId: result.token,\r\n                    amount: amount,\r\n                    currency: \"USD\",\r\n                    orderId: orderId,\r\n                    customerEmail: customerEmail,\r\n                    customerId: customerName,\r\n                  }),\r\n                });\r\n\r\n                console.log(\"Payment response status:\", response.status);\r\n\r\n                let paymentResult;\r\n                try {\r\n                  paymentResult = await response.json();\r\n                } catch (parseError) {\r\n                  console.error(\"Error parsing payment response:\", parseError);\r\n                  throw new Error(\r\n                    \"Failed to parse payment response from server\",\r\n                  );\r\n                }\r\n\r\n                console.log(\"Payment response data:\", paymentResult);\r\n\r\n                if (response.ok && paymentResult.success) {\r\n                  console.log(\r\n                    \"Payment created successfully:\",\r\n                    paymentResult.payment,\r\n                  );\r\n\r\n                  if (statusContainer) {\r\n                    statusContainer.innerHTML = `\r\n                      <div class=\"bg-green-50 border border-green-200 rounded-lg p-3 space-y-2\">\r\n                        <div class=\"text-green-700 font-bold\"> Payment completed successfully!</div>\r\n                        <div class=\"text-sm text-green-600\">Payment ID: ${paymentResult.payment.id}</div>\r\n                        <div class=\"text-sm text-green-600\">Amount: $${paymentResult.payment.amount.toFixed(2)}</div>\r\n                      </div>\r\n                    `;\r\n                  }\r\n\r\n                  // Redirect after a brief delay\r\n                  setTimeout(() => {\r\n                    onPaymentSuccess(result.token);\r\n                  }, 2000);\r\n                } else {\r\n                  let errorMessage = `Payment creation failed: ${paymentResult.error || \"Unknown error\"}`;\r\n                  if (paymentResult.details) {\r\n                    errorMessage += ` - ${paymentResult.details}`;\r\n                  }\r\n                  throw new Error(errorMessage);\r\n                }\r\n              } else {\r\n                let errorMessage = `Tokenization failed with status: ${result.status}`;\r\n                if (result.errors) {\r\n                  errorMessage += ` - ${JSON.stringify(result.errors)}`;\r\n                }\r\n                throw new Error(errorMessage);\r\n              }\r\n            } catch (e) {\r\n              console.error(\"Payment error:\", e);\r\n              if (statusContainer) {\r\n                const errorMsg =\r\n                  e instanceof Error ? e.message : \"Payment failed\";\r\n                statusContainer.innerHTML = `\r\n                  <div class=\"bg-red-50 border border-red-200 rounded-lg p-3\">\r\n                    <div class=\"text-red-700 font-bold\"> Payment Failed</div>\r\n                    <div class=\"text-sm text-red-600 mt-1\">${errorMsg}</div>\r\n                  </div>\r\n                `;\r\n              }\r\n            }\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to initialize Square payments:\", error);\r\n      }\r\n    };\r\n\r\n    initializePayments();\r\n  }, [amount, orderId, customerEmail, customerName, onPaymentSuccess]);\r\n\r\n  return (\r\n    <div id=\"payment-form\" className=\"space-y-4\">\r\n      <div className=\"bg-white border border-gray-200 rounded-lg p-6\">\r\n        <div className=\"mb-6\">\r\n          <h3 className=\"text-lg font-bold text-gray-900 mb-2\">Payment Details</h3>\r\n          <p className=\"text-gray-600 text-sm\">Amount: ${amount.toFixed(2)}</p>\r\n        </div>\r\n\r\n        <div\r\n          id=\"payment-status-container\"\r\n          className=\"mb-4 text-sm font-medium text-gray-900\"\r\n        />\r\n\r\n        <div\r\n          id=\"card-container\"\r\n          className=\"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-14\"\r\n        />\r\n\r\n        <button\r\n          id=\"card-button\"\r\n          type=\"button\"\r\n          disabled={isLoading}\r\n          className=\"w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-all disabled:opacity-50\"\r\n        >\r\n          Pay ${amount.toFixed(2)}\r\n        </button>\r\n\r\n        <p className=\"text-xs text-gray-500 text-center mt-4\">\r\n          Secure payment powered by Square\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}