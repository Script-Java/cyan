module.exports=[89997,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(65967),e=a.i(57999),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(3130),j=a.i(32860),k=a.i(96221),l=a.i(92e3),m=a.i(23292),n=a.i(87682),o=a.i(65602);let p=[{code:"US",name:"United States"},{code:"CA",name:"Canada"},{code:"GB",name:"United Kingdom"},{code:"AU",name:"Australia"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"JP",name:"Japan"},{code:"CN",name:"China"}],q=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];function r(){let a=(0,d.useNavigate)(),[r]=(0,e.useSearchParams)(),s=r.get("cartId"),t=localStorage.getItem("cart_id"),u=s||t,[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(0),[z]=(0,c.useState)(.08),[A]=(0,c.useState)(9.99),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)({firstName:"",lastName:"",email:"",phone:"",street:"",street2:"",city:"",state:"CA",postalCode:"",country:"US"}),[N,O]=(0,c.useState)({same_as_shipping:!0,firstName:"",lastName:"",street:"",street2:"",city:"",state:"CA",postalCode:"",country:"US"}),[P,Q]=(0,c.useState)({cardholderName:"",cardNumber:"",expiryMonth:"",expiryYear:"",cvv:""}),[R,S]=(0,c.useState)("");(0,c.useEffect)(()=>{let a=localStorage.getItem("auth_token"),b=localStorage.getItem("customer_id");G(a),I(b?parseInt(b):null)},[a]),(0,c.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/square/config");if(a.ok){let b=await a.json();b.applicationId&&S(b.applicationId)}}catch(a){console.error("Failed to load Square config:",a)}})()},[]),(0,c.useEffect)(()=>{let a=async()=>{try{let a;if(!u){console.log("No cart ID provided, allowing checkout to proceed"),C(!1);return}let b=new AbortController,c=setTimeout(()=>b.abort(),5e3),d=await fetch(`/api/cart/${u}`,{signal:b.signal});if(clearTimeout(c),!d.ok)throw Error(`Failed to load cart (Status: ${d.status})`);let e=await d.text();try{a=e?JSON.parse(e):{}}catch{throw Error("Invalid cart response format")}w(a.data?.line_items||[]),y(a.data?.subtotal||0)}catch(a){console.error("Cart loading error:",a instanceof Error?a.message:"Failed to load cart")}finally{C(!1)}};u?a():C(!1)},[u]);let T=(a,b)=>{let c={...L,[a]:b};M(c),N.same_as_shipping&&O(a=>({...a,firstName:c.firstName,lastName:c.lastName,street:c.street,street2:c.street2,city:c.city,state:c.state,postalCode:c.postalCode,country:c.country}))},U=(a,b)=>{"same_as_shipping"===a?(O(a=>({...a,same_as_shipping:b})),b&&O(a=>({...a,firstName:L.firstName,lastName:L.lastName,street:L.street,street2:L.street2,city:L.city,state:L.state,postalCode:L.postalCode,country:L.country}))):O(c=>({...c,[a]:b}))},V=async a=>{if(a.preventDefault(),K(null),L.firstName&&L.lastName&&L.email&&L.phone&&L.street&&L.city&&L.state&&L.postalCode?!!N.same_as_shipping||!!N.firstName&&!!N.lastName&&!!N.street&&!!N.city&&!!N.state&&!!N.postalCode||(K("Please fill in all required billing fields"),!1):(K("Please fill in all required shipping fields"),!1)){E(!0);try{let a,b=x+x*z+A;console.log("Creating Square Checkout session, total:",b);let c={amount:b,currency:"USD",items:v,shippingAddress:{firstName:L.firstName,lastName:L.lastName,street:L.street,street2:L.street2,city:L.city,state:L.state,postalCode:L.postalCode,country:L.country},billingAddress:N.same_as_shipping?{firstName:L.firstName,lastName:L.lastName,street:L.street,street2:L.street2,city:L.city,state:L.state,postalCode:L.postalCode,country:L.country}:{firstName:N.firstName,lastName:N.lastName,street:N.street,street2:N.street2,city:N.city,state:N.state,postalCode:N.postalCode,country:N.country},subtotal:x,tax:x*z,shipping:A,total:b,customerId:H||void 0,customerEmail:L.email,customerName:`${L.firstName} ${L.lastName}`},d=await fetch("/api/square/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});console.log("Checkout response status:",d.status);try{a=await d.json()}catch(a){throw console.error("Failed to parse checkout response:",{error:a,status:d.status}),Error(`Checkout response parsing failed. Status: ${d.status}.`)}if(!d.ok){let b=a?.error||a?.message||`Checkout failed (${d.status})`;throw console.error("Checkout failed:",{status:d.status,error:a}),Error(b)}if(a.checkoutUrl)console.log("Redirecting to Square Checkout:",a.checkoutUrl),window.location.href=a.checkoutUrl;else throw Error("No checkout URL returned from server")}catch(b){let a=b instanceof Error?b.message:"Failed to create checkout";K(a),m.toast.error(a),console.error("Checkout creation error:",b)}finally{E(!1)}}},W=x*z,X=x+W+A;return B?(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("main",{className:"pt-20 min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsx)(k.Loader2,{className:"w-8 h-8 animate-spin text-[#FFD713]"})})}):(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("main",{className:"pt-20 min-h-screen bg-gray-50 py-12",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-4xl font-bold text-[#030140] mb-2",children:"Checkout"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Complete your purchase"})]}),J&&(0,b.jsxs)(o.Alert,{variant:"destructive",className:"mb-6",children:[(0,b.jsx)(l.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(o.AlertDescription,{children:J})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsx)("div",{className:"lg:col-span-2",children:(0,b.jsxs)("form",{onSubmit:V,className:"space-y-8",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsx)(i.CardTitle,{children:"Shipping Address"}),(0,b.jsx)(i.CardDescription,{children:"Where should we deliver your order?"})]}),(0,b.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"firstName",children:"First Name *"}),(0,b.jsx)(g.Input,{id:"firstName",value:L.firstName,onChange:a=>T("firstName",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"lastName",children:"Last Name *"}),(0,b.jsx)(g.Input,{id:"lastName",value:L.lastName,onChange:a=>T("lastName",a.target.value),required:!0})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"email",children:"Email Address *"}),(0,b.jsx)(g.Input,{id:"email",type:"email",value:L.email,onChange:a=>T("email",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"phone",children:"Phone Number *"}),(0,b.jsx)(g.Input,{id:"phone",type:"tel",value:L.phone,onChange:a=>T("phone",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"street",children:"Street Address *"}),(0,b.jsx)(g.Input,{id:"street",value:L.street,onChange:a=>T("street",a.target.value),placeholder:"123 Main St",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"street2",children:"Apt, Suite, etc. (optional)"}),(0,b.jsx)(g.Input,{id:"street2",value:L.street2,onChange:a=>T("street2",a.target.value),placeholder:"Apt 4B"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"city",children:"City *"}),(0,b.jsx)(g.Input,{id:"city",value:L.city,onChange:a=>T("city",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"postalCode",children:"Postal Code *"}),(0,b.jsx)(g.Input,{id:"postalCode",value:L.postalCode,onChange:a=>T("postalCode",a.target.value),required:!0})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"country",children:"Country *"}),(0,b.jsxs)(n.Select,{value:L.country,onValueChange:a=>T("country",a),children:[(0,b.jsx)(n.SelectTrigger,{children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsx)(n.SelectContent,{children:p.map(a=>(0,b.jsx)(n.SelectItem,{value:a.code,children:a.name},a.code))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"state",children:"State/Province *"}),"US"===L.country?(0,b.jsxs)(n.Select,{value:L.state,onValueChange:a=>T("state",a),children:[(0,b.jsx)(n.SelectTrigger,{children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsx)(n.SelectContent,{children:q.map(a=>(0,b.jsx)(n.SelectItem,{value:a,children:a},a))})]}):(0,b.jsx)(g.Input,{value:L.state,onChange:a=>T("state",a.target.value),placeholder:"State/Province",required:!0})]})]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Billing Address"})}),(0,b.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,b.jsx)("input",{type:"checkbox",id:"sameAsShipping",checked:N.same_as_shipping,onChange:a=>U("same_as_shipping",a.target.checked),className:"w-4 h-4"}),(0,b.jsx)(h.Label,{htmlFor:"sameAsShipping",className:"cursor-pointer font-normal",children:"Same as shipping address"})]}),!N.same_as_shipping&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billFirstName",children:"First Name *"}),(0,b.jsx)(g.Input,{id:"billFirstName",value:N.firstName,onChange:a=>U("firstName",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billLastName",children:"Last Name *"}),(0,b.jsx)(g.Input,{id:"billLastName",value:N.lastName,onChange:a=>U("lastName",a.target.value),required:!0})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billStreet",children:"Street Address *"}),(0,b.jsx)(g.Input,{id:"billStreet",value:N.street,onChange:a=>U("street",a.target.value),placeholder:"123 Main St",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billStreet2",children:"Apt, Suite, etc. (optional)"}),(0,b.jsx)(g.Input,{id:"billStreet2",value:N.street2,onChange:a=>U("street2",a.target.value),placeholder:"Apt 4B"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billCity",children:"City *"}),(0,b.jsx)(g.Input,{id:"billCity",value:N.city,onChange:a=>U("city",a.target.value),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billPostalCode",children:"Postal Code *"}),(0,b.jsx)(g.Input,{id:"billPostalCode",value:N.postalCode,onChange:a=>U("postalCode",a.target.value),required:!0})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billCountry",children:"Country *"}),(0,b.jsxs)(n.Select,{value:N.country,onValueChange:a=>U("country",a),children:[(0,b.jsx)(n.SelectTrigger,{children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsx)(n.SelectContent,{children:p.map(a=>(0,b.jsx)(n.SelectItem,{value:a.code,children:a.name},a.code))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"billState",children:"State/Province *"}),"US"===N.country?(0,b.jsxs)(n.Select,{value:N.state,onValueChange:a=>U("state",a),children:[(0,b.jsx)(n.SelectTrigger,{children:(0,b.jsx)(n.SelectValue,{})}),(0,b.jsx)(n.SelectContent,{children:q.map(a=>(0,b.jsx)(n.SelectItem,{value:a,children:a},a))})]}):(0,b.jsx)(g.Input,{value:N.state,onChange:a=>U("state",a.target.value),placeholder:"State/Province",required:!0})]})]})]})]})]}),(0,b.jsx)(f.Button,{type:"submit",className:"w-full bg-[#FFD713] text-[#030140] hover:bg-[#FFD713]/90 py-6 text-lg font-bold disabled:opacity-50",disabled:D,children:D?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"w-5 h-5 mr-2 animate-spin"}),"Processing..."]}):(0,b.jsxs)(b.Fragment,{children:["Complete Order",(0,b.jsx)(j.ArrowRight,{className:"w-5 h-5 ml-2"})]})})]})}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(i.Card,{className:"sticky top-24",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Order Summary"})}),(0,b.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,b.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto border-b pb-4",children:0===v.length?(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"No items in cart"}):v.map((a,c)=>(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.product_name||`Product #${a.product_id}`}),(0,b.jsxs)("p",{className:"text-gray-600",children:["Qty: ",a.quantity]})]}),(0,b.jsxs)("p",{className:"font-medium",children:["$",((a.price||.25)*a.quantity).toFixed(2)]})]},c))}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Subtotal"}),(0,b.jsxs)("span",{children:["$",x.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Tax"}),(0,b.jsxs)("span",{children:["$",W.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Shipping"}),(0,b.jsxs)("span",{children:["$",A.toFixed(2)]})]})]}),(0,b.jsx)("div",{className:"border-t pt-4",children:(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{children:["$",X.toFixed(2)]})]})})]})]})})]})]})})})}a.s(["default",()=>r])}];

//# sourceMappingURL=client_pages_Checkout_tsx_76af1ff7._.js.map